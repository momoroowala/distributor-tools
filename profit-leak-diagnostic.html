<!DOCTYPE html>
<html lang="en">
<head>
    <link rel="icon" type="image/svg+xml" href="favicon.svg">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Profit Leak Diagnostic | Free Tool for Distributors</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <style>
        *{margin:0;padding:0;box-sizing:border-box}
        :root{--bg-primary:#0a0a0f;--bg-secondary:#12121a;--bg-tertiary:#1a1a25;--accent:#ef4444;--accent-hover:#f87171;--accent-light:rgba(239,68,68,0.1);--accent2:#f59e0b;--text-primary:#f1f5f9;--text-secondary:#94a3b8;--text-muted:#64748b;--border:#2a2a3a;--success:#22c55e;--warning:#f59e0b;--danger:#ef4444}
        body{font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,sans-serif;background:var(--bg-primary);color:var(--text-primary);min-height:100vh;line-height:1.6}
        .container{max-width:700px;margin:0 auto;padding:2rem}
        header{text-align:center;margin-bottom:2rem;padding-top:2rem}
        .badge{display:inline-block;background:var(--accent);color:white;padding:0.25rem 0.75rem;border-radius:9999px;font-size:0.75rem;font-weight:600;text-transform:uppercase;letter-spacing:0.05em;margin-bottom:1rem}
        h1{font-size:2.1rem;font-weight:700;margin-bottom:0.75rem;background:linear-gradient(135deg,var(--text-primary) 0%,var(--accent) 100%);-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text}
        .subtitle{color:var(--text-secondary);font-size:1.05rem;max-width:520px;margin:0 auto}
        .progress-container{background:var(--bg-secondary);border:1px solid var(--border);border-radius:1rem;padding:1.25rem 1.5rem;margin-bottom:1.5rem}
        .progress-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:0.5rem}
        .progress-label{font-size:0.8rem;color:var(--text-muted)}
        .progress-count{font-size:0.8rem;color:var(--accent);font-weight:600}
        .progress-bar{height:6px;background:var(--bg-tertiary);border-radius:9999px;overflow:hidden}
        .progress-fill{height:100%;background:linear-gradient(90deg,var(--accent),var(--accent2));border-radius:9999px;transition:width 0.3s}
        /* Running Total */
        .running-total{background:var(--bg-secondary);border:1px solid var(--border);border-radius:1rem;padding:1.25rem 1.5rem;margin-bottom:1.5rem;display:flex;align-items:center;justify-content:space-between}
        .running-total .label{font-size:0.85rem;color:var(--text-muted)}
        .running-total .amount{font-size:1.75rem;font-weight:700;color:var(--accent);font-variant-numeric:tabular-nums;transition:all 0.3s}
        /* Question Card */
        .q-card{background:var(--bg-secondary);border:1px solid var(--border);border-radius:1rem;padding:2rem;display:none}
        .q-card.active{display:block;animation:slideIn 0.3s ease}
        @keyframes slideIn{from{opacity:0;transform:translateX(20px)}to{opacity:1;transform:translateX(0)}}
        .q-category{display:inline-block;background:var(--accent-light);color:var(--accent);padding:0.2rem 0.6rem;border-radius:0.25rem;font-size:0.7rem;font-weight:600;text-transform:uppercase;letter-spacing:0.05em;margin-bottom:0.75rem}
        .q-text{font-size:1.15rem;font-weight:600;margin-bottom:0.5rem;line-height:1.35}
        .q-hint{font-size:0.8rem;color:var(--text-muted);margin-bottom:1.25rem}
        .input-group{margin-bottom:1rem}
        .input-group label{display:block;font-size:0.85rem;color:var(--text-secondary);margin-bottom:0.4rem;font-weight:500}
        .input-row{display:flex;align-items:stretch}
        .input-row input{flex:1;padding:0.75rem 1rem;background:var(--bg-tertiary);border:1px solid var(--border);border-radius:0.5rem 0 0 0.5rem;color:var(--text-primary);font-size:1rem;border-right:none}
        .input-row input:focus{outline:none;border-color:var(--accent)}
        .input-row .unit{background:var(--bg-tertiary);border:1px solid var(--border);border-left:none;border-radius:0 0.5rem 0.5rem 0;padding:0 0.75rem;display:flex;align-items:center;color:var(--text-muted);font-size:0.8rem;min-width:60px;justify-content:center}
        select{width:100%;padding:0.75rem 1rem;background:var(--bg-tertiary);border:1px solid var(--border);border-radius:0.5rem;color:var(--text-primary);font-size:1rem}
        select:focus{outline:none;border-color:var(--accent)}
        .nav-buttons{display:flex;gap:1rem;margin-top:1.5rem}
        .btn{flex:1;padding:0.875rem 1.25rem;border-radius:0.5rem;font-weight:600;font-size:0.95rem;cursor:pointer;transition:all 0.2s;border:none}
        .btn-primary{background:var(--accent);color:white}
        .btn-primary:hover{background:var(--accent-hover)}
        .btn-secondary{background:var(--bg-tertiary);color:var(--text-secondary);border:1px solid var(--border)}
        .btn-secondary:hover{background:var(--border);color:var(--text-primary)}
        .btn:disabled{opacity:0.5;cursor:not-allowed}
        /* Leak Reveal */
        .leak-reveal{background:var(--accent-light);border:1px solid rgba(239,68,68,0.3);border-radius:0.75rem;padding:1rem;margin-top:1rem;display:none}
        .leak-reveal.active{display:block;animation:fadeIn 0.3s ease}
        .leak-reveal .leak-amount{font-size:1.3rem;font-weight:700;color:var(--accent)}
        .leak-reveal .leak-desc{font-size:0.85rem;color:var(--text-secondary);margin-top:0.25rem}
        @keyframes fadeIn{from{opacity:0;transform:translateY(10px)}to{opacity:1;transform:translateY(0)}}
        /* Results */
        .results-page{display:none}
        .results-page.active{display:block;animation:fadeIn 0.4s ease}
        .total-card{background:var(--bg-secondary);border:2px solid var(--accent);border-radius:1rem;padding:2.5rem;text-align:center;margin-bottom:2rem}
        .total-card .reveal-text{font-size:1rem;color:var(--text-secondary);margin-bottom:0.5rem}
        .total-card .total-amount{font-size:3.5rem;font-weight:700;color:var(--accent);line-height:1}
        .total-card .total-sub{font-size:1rem;color:var(--text-muted);margin-top:0.5rem}
        .total-card .total-context{color:var(--text-secondary);margin-top:1rem;font-size:0.95rem}
        .leaks-breakdown{background:var(--bg-secondary);border:1px solid var(--border);border-radius:1rem;padding:2rem;margin-bottom:2rem}
        .leaks-breakdown h3{font-size:1.1rem;margin-bottom:1.25rem}
        .leak-row{display:flex;justify-content:space-between;align-items:center;padding:0.75rem 0;border-bottom:1px solid var(--border)}
        .leak-row:last-child{border-bottom:none}
        .leak-row .name{font-size:0.9rem;color:var(--text-secondary)}
        .leak-row .val{font-size:1rem;font-weight:600;color:var(--accent)}
        .leak-bar-container{flex:1;height:8px;background:var(--bg-tertiary);border-radius:9999px;margin:0 1rem;overflow:hidden}
        .leak-bar{height:100%;background:linear-gradient(90deg,var(--accent),var(--accent2));border-radius:9999px}
        /* Download Section */
        .download-section{background:linear-gradient(135deg,var(--accent-light),var(--bg-secondary));border:2px solid var(--accent);border-radius:1rem;padding:2.5rem;text-align:center;margin-bottom:2rem}
        .download-section h3{font-size:1.4rem;margin-bottom:0.5rem}
        .download-section>p{color:var(--text-secondary);margin-bottom:1.5rem}
        .download-features{display:flex;justify-content:center;gap:1.5rem;margin-bottom:1.5rem;flex-wrap:wrap}
        .download-feature{display:flex;align-items:center;gap:0.4rem;font-size:0.85rem;color:var(--text-secondary)}
        .download-feature .icon{color:var(--success)}
        .email-form{display:flex;gap:0.75rem;max-width:450px;margin:0 auto;flex-wrap:wrap}
        .email-form input[type="email"]{flex:1;min-width:200px;padding:0.875rem 1rem;background:var(--bg-primary);border:1px solid var(--border);border-radius:0.5rem;color:var(--text-primary);font-size:1rem}
        .email-form input:focus{outline:none;border-color:var(--accent)}
        .email-form .btn{flex:none;min-width:180px}
        .download-complete{display:none;color:var(--success);padding:1rem;font-size:1rem}
        .download-complete.active{display:block}
        footer{text-align:center;padding:2rem;color:var(--text-muted);font-size:0.875rem}
        footer a{color:var(--accent);text-decoration:none}
        @media(max-width:640px){.container{padding:1rem}h1{font-size:1.65rem}.total-card .total-amount{font-size:2.5rem}.running-total .amount{font-size:1.3rem}}
    </style>
</head>
<body>
<div class="container">
    <header>
    <link rel="icon" type="image/svg+xml" href="favicon.svg">
        <span class="badge">Free Diagnostic</span>
        <h1>The $100K You Don't Know You're Losing</h1>
        <p class="subtitle">Answer 8 questions about your operations. We'll calculate exactly how much profit is silently leaking from your distribution business.</p>
    </header>
    <div class="progress-container" id="progressContainer">
        <div class="progress-header">
            <span class="progress-label">Diagnostic Progress</span>
            <span class="progress-count"><span id="currentQ">1</span> of <span id="totalQ">8</span></span>
        </div>
        <div class="progress-bar"><div class="progress-fill" id="progressFill" style="width:12.5%"></div></div>
    </div>
    <div class="running-total" id="runningTotal">
        <span class="label">&#128176; Estimated Annual Profit Leakage</span>
        <span class="amount" id="runningAmount">$0</span>
    </div>
    <div id="questionsContainer"></div>
    <div class="results-page" id="resultsPage">
        <div class="total-card">
            <div class="reveal-text">Your distribution business is silently losing an estimated</div>
            <div class="total-amount" id="finalTotal">$0</div>
            <div class="total-sub">per year</div>
            <div class="total-context" id="totalContext"></div>
        </div>
        <div class="leaks-breakdown">
            <h3>Where It's Going</h3>
            <div id="leaksBreakdown"></div>
        </div>
        <div class="download-section" id="downloadSection">
            <h3>&#128196; Get Your Full Profit Recovery Plan</h3>
            <p>Download a detailed PDF showing exactly how to plug each leak, with implementation timelines and projected ROI.</p>
            <div class="download-features">
                <div class="download-feature"><span class="icon">&#9989;</span><span>Fix-by-fix action plan</span></div>
                <div class="download-feature"><span class="icon">&#128200;</span><span>ROI per improvement</span></div>
                <div class="download-feature"><span class="icon">&#127942;</span><span>Priority ranking</span></div>
            </div>
            <form class="email-form" id="emailForm" onsubmit="handleDownload(event)" style="flex-direction:column;align-items:stretch;max-width:420px;margin:0 auto;gap:0.5rem;">
                <div style="display:flex;gap:0.5rem;width:100%;">
                    <input type="text" id="userFirst" placeholder="First name" required style="flex:1;padding:0.75rem;background:var(--bg);border:1px solid var(--border);border-radius:0.5rem;color:var(--text);font-size:0.95rem;">
                    <input type="text" id="userLast" placeholder="Last name" required style="flex:1;padding:0.75rem;background:var(--bg);border:1px solid var(--border);border-radius:0.5rem;color:var(--text);font-size:0.95rem;">
                </div>
                <input type="email" id="userEmail" placeholder="Work email" required style="width:100%;padding:0.75rem;background:var(--bg);border:1px solid var(--border);border-radius:0.5rem;color:var(--text);font-size:0.95rem;">
                <button type="submit" class="btn btn-primary">Download PDF Report</button>
            </form>
            <div class="download-complete" id="downloadComplete">? Report downloaded! Check your downloads folder.</div>
            <div style="margin-top:2rem;padding:1.5rem;background:var(--bg-tertiary);border:1px solid var(--border);border-radius:1rem;text-align:center;max-width:420px;margin-left:auto;margin-right:auto;overflow:hidden;box-sizing:border-box;">
                <div style="font-size:0.7rem;text-transform:uppercase;letter-spacing:0.05em;color:var(--accent2);font-weight:600;margin-bottom:0.5rem;">Want the full picture?</div>
                <h3 style="font-size:1.1rem;font-weight:700;margin-bottom:0.5rem;color:var(--text-primary);">Get Your Custom Savings Roadmap</h3>
                <p style="font-size:0.85rem;color:var(--text-secondary);margin-bottom:0.75rem;line-height:1.5;padding:0 0.5rem;">15 minutes. We walk through your specific numbers, show you exactly where you're bleeding money, and give you a prioritized fix list. Yours to keep whether you work with us or not.</p>
                <a href="https://calendly.com/mo-deeplineop/30min" target="_blank" rel="noopener" style="display:inline-block;padding:0.75rem 1.25rem;background:var(--accent2);color:#0a0a0f;font-weight:700;font-size:0.9rem;border-radius:0.5rem;text-decoration:none;transition:all 0.2s;max-width:100%;box-sizing:border-box;" onmouseover="this.style.opacity='0.85'" onmouseout="this.style.opacity='1'">Get Your Free Savings Roadmap &#x2192;</a>
                <p style="font-size:0.75rem;color:var(--text-muted);margin-top:0.5rem;">Free. No pitch. The roadmap is yours to keep.</p>
            </div>
        </div>
    </div>
    <footer><p>Built by <a href="#">Mo Roowala</a> | AI Automation for Distributors</p></footer>
</div>
<script>
const { jsPDF } = window.jspdf;

const steps = [
    {
        category: "Revenue",
        question: "What is your approximate annual revenue?",
        hint: "This helps us calculate dollar amounts specific to your business.",
        inputs: [
            { id: "revenue", label: "Annual Revenue", type: "number", placeholder: "e.g., 25000000", unit: "$" }
        ],
        calc: (vals) => ({ leak: 0, label: "Baseline", desc: "" })
    },
    {
        category: "Pricing",
        question: "How do your sales reps handle pricing?",
        hint: "Inconsistent pricing is the #1 profit leak in distribution. A 1% price reduction can wipe out 11% of profit.",
        inputs: [
            { id: "pricingMethod", label: "Primary pricing method", type: "select", options: [
                { value: "gut", text: "Reps decide based on gut/experience" },
                { value: "lists", text: "Price lists exist but lots of exceptions" },
                { value: "system", text: "System-driven with clear rules" }
            ]},
            { id: "overridesPerWeek", label: "Price overrides or exceptions per week", type: "number", placeholder: "e.g., 15", unit: "/week" }
        ],
        calc: (vals) => {
            const rev = parseFloat(vals.revenue) || 0;
            const method = vals.pricingMethod;
            const overrides = parseFloat(vals.overridesPerWeek) || 0;
            let leakPct = method === 'gut' ? 0.01 : method === 'lists' ? 0.006 : 0.002;
            leakPct += (overrides * 0.0001); // 0.01% per override
            const leak = Math.round(rev * leakPct);
            return { leak, label: "Pricing Inconsistency", desc: `${overrides} overrides/week at ~${(leakPct*100).toFixed(2)}% revenue impact` };
        }
    },
    {
        category: "Order Processing",
        question: "How many orders does your team process per day, and how?",
        hint: "Manual order entry costs $5-15 per order in labor. Errors cost 10-20x more to fix.",
        inputs: [
            { id: "ordersPerDay", label: "Orders processed per day", type: "number", placeholder: "e.g., 50", unit: "/day" },
            { id: "manualPct", label: "% entered manually (from email/phone)", type: "number", placeholder: "e.g., 70", unit: "%" },
            { id: "errorRate", label: "Estimated error rate", type: "number", placeholder: "e.g., 3", unit: "%" }
        ],
        calc: (vals) => {
            const orders = parseFloat(vals.ordersPerDay) || 0;
            const manual = (parseFloat(vals.manualPct) || 0) / 100;
            const errorRate = (parseFloat(vals.errorRate) || 0) / 100;
            const manualCostPerOrder = 5;
            const errorCostPerOrder = 120; // includes freight, restock, customer goodwill
            const yearlyOrders = orders * 260;
            const manualCost = Math.round(yearlyOrders * manual * manualCostPerOrder);
            const errorCost = Math.round(yearlyOrders * errorRate * errorCostPerOrder);
            const leak = manualCost + errorCost;
            return { leak, label: "Order Processing Waste", desc: `${Math.round(yearlyOrders*manual).toLocaleString()} manual entries + ${Math.round(yearlyOrders*errorRate).toLocaleString()} errors/year` };
        }
    },
    {
        category: "Quoting",
        question: "How long does it take to turn around a quote?",
        hint: "Every hour of delay on a quote reduces win rate by 2-5%. Speed to quote is speed to revenue.",
        inputs: [
            { id: "quotesPerWeek", label: "Quotes sent per week", type: "number", placeholder: "e.g., 30", unit: "/week" },
            { id: "quoteHours", label: "Average hours to send a quote", type: "number", placeholder: "e.g., 4", unit: "hours" },
            { id: "avgQuoteValue", label: "Average quote value", type: "number", placeholder: "e.g., 5000", unit: "$" }
        ],
        calc: (vals) => {
            const quotes = parseFloat(vals.quotesPerWeek) || 0;
            const hours = parseFloat(vals.quoteHours) || 0;
            const value = parseFloat(vals.avgQuoteValue) || 0;
            const lostPct = Math.min(hours * 0.02, 0.15);
            const yearlyQuotes = quotes * 52;
            const leak = Math.round(yearlyQuotes * value * lostPct * 0.20); // 20% gross margin proxy - lost deals = lost gross profit
            return { leak, label: "Slow Quote Response", desc: `${hours}hr avg turnaround losing ~${(lostPct*100).toFixed(0)}% of winnable deals` };
        }
    },
    {
        category: "Inventory",
        question: "How accurate is your inventory, and how often do you have stockouts?",
        hint: "The average distributor has 20-30% excess inventory and 5-10% stockout rate.",
        inputs: [
            { id: "inventoryValue", label: "Total inventory value", type: "number", placeholder: "e.g., 3000000", unit: "$" },
            { id: "stockoutPct", label: "Estimated stockout rate (% of orders)", type: "number", placeholder: "e.g., 5", unit: "%" },
            { id: "excessPct", label: "Estimated excess/dead stock (%)", type: "number", placeholder: "e.g., 15", unit: "%" }
        ],
        calc: (vals) => {
            const rev = parseFloat(vals.revenue) || 0;
            const inv = parseFloat(vals.inventoryValue) || 0;
            const stockout = (parseFloat(vals.stockoutPct) || 0) / 100;
            const excess = (parseFloat(vals.excessPct) || 0) / 100;
            const stockoutLoss = Math.round(rev * stockout * 0.15);
            const carryingCost = Math.round(inv * excess * 0.25);
            const leak = stockoutLoss + carryingCost;
            return { leak, label: "Inventory Mismanagement", desc: `$${stockoutLoss.toLocaleString()} lost sales + $${carryingCost.toLocaleString()} carrying cost` };
        }
    },
    {
        category: "Customer Retention",
        question: "What does customer churn look like for you?",
        hint: "Acquiring a new customer costs 5-7x more than retaining one. Most distributors don't track churn.",
        inputs: [
            { id: "totalCustomers", label: "Active customers", type: "number", placeholder: "e.g., 200", unit: "" },
            { id: "churnPct", label: "% of customers lost per year", type: "number", placeholder: "e.g., 10", unit: "%" },
            { id: "avgCustomerValue", label: "Average annual customer value", type: "number", placeholder: "e.g., 50000", unit: "$" }
        ],
        calc: (vals) => {
            const customers = parseFloat(vals.totalCustomers) || 0;
            const churn = (parseFloat(vals.churnPct) || 0) / 100;
            const acv = parseFloat(vals.avgCustomerValue) || 0;
            const preventable = 0.3;
            const leak = Math.round(customers * churn * acv * preventable);
            return { leak, label: "Preventable Customer Churn", desc: `${Math.round(customers*churn)} customers lost/year, ~30% preventable with automation` };
        }
    },
    {
        category: "Labor",
        question: "How much time does your team spend on tasks that should be automated?",
        hint: "The average distributor employee spends 40% of their time on repetitive manual tasks.",
        inputs: [
            { id: "employeeCount", label: "Number of office/admin employees", type: "number", placeholder: "e.g., 12", unit: "" },
            { id: "avgSalary", label: "Average annual salary", type: "number", placeholder: "e.g., 55000", unit: "$" },
            { id: "manualTimePct", label: "% of time on repetitive manual work", type: "number", placeholder: "e.g., 35", unit: "%" }
        ],
        calc: (vals) => {
            const count = parseFloat(vals.employeeCount) || 0;
            const salary = parseFloat(vals.avgSalary) || 0;
            const manual = (parseFloat(vals.manualTimePct) || 0) / 100;
            const automatable = 0.6;
            const leak = Math.round(count * salary * manual * automatable);
            return { leak, label: "Wasted Labor Hours", desc: `${count} employees x ${(manual*100).toFixed(0)}% manual time x 60% automatable` };
        }
    },
    {
        category: "Supplier",
        question: "How do you handle supplier price changes?",
        hint: "Most distributors take 2-4 weeks to pass through supplier increases. Every day of delay erodes margin.",
        inputs: [
            { id: "priceChangesYear", label: "Supplier price changes per year", type: "number", placeholder: "e.g., 50", unit: "/year" },
            { id: "daysToUpdate", label: "Average days to update your prices", type: "number", placeholder: "e.g., 14", unit: "days" },
            { id: "avgChangeImpact", label: "Avg revenue affected per change", type: "number", placeholder: "e.g., 100000", unit: "$" }
        ],
        calc: (vals) => {
            const changes = parseFloat(vals.priceChangesYear) || 0;
            const days = parseFloat(vals.daysToUpdate) || 0;
            const impact = parseFloat(vals.avgChangeImpact) || 0;
            const dailyMarginLoss = 0.0005; // 0.05% per day
            const leak = Math.round(changes * days * impact * dailyMarginLoss);
            return { leak, label: "Slow Price Pass-Through", desc: `${days} day avg delay across ${changes} changes/year` };
        }
    }
];

let currentStep = 0;
let allValues = {};
let leaks = [];
let runningLeak = 0;

function init() {
    document.getElementById('totalQ').textContent = steps.length;
    renderStep(0);
}

function renderStep(idx) {
    const s = steps[idx];
    const container = document.getElementById('questionsContainer');
    let html = `<div class="q-card active">
        <span class="q-category">${s.category}</span>
        <h2 class="q-text">${s.question}</h2>
        <p class="q-hint">${s.hint}</p>`;

    s.inputs.forEach(inp => {
        html += `<div class="input-group"><label for="${inp.id}">${inp.label}</label>`;
        if (inp.type === 'select') {
            html += `<select id="${inp.id}">`;
            inp.options.forEach(o => {
                const sel = allValues[inp.id] === o.value ? 'selected' : '';
                html += `<option value="${o.value}" ${sel}>${o.text}</option>`;
            });
            html += `</select>`;
        } else {
            const val = allValues[inp.id] || '';
            if (inp.unit && inp.unit !== '') {
                html += `<div class="input-row"><input type="number" id="${inp.id}" placeholder="${inp.placeholder}" value="${val}" min="0" step="any">
                    <span class="unit">${inp.unit}</span></div>`;
            } else {
                html += `<div class="input-row"><input type="number" id="${inp.id}" placeholder="${inp.placeholder}" value="${val}" min="0" step="any">
                    <span class="unit">#</span></div>`;
            }
        }
        html += `</div>`;
    });

    html += `<div class="leak-reveal" id="leakReveal"></div>
        <div class="nav-buttons">
            <button class="btn btn-secondary" onclick="prevStep()" ${idx===0?'disabled':''}>? Back</button>
            <button class="btn btn-primary" onclick="nextStep()" id="nextBtn">${idx===steps.length-1?'See Full Results':'Next ?'}</button>
        </div></div>`;

    container.innerHTML = html;
    document.getElementById('currentQ').textContent = idx + 1;
    document.getElementById('progressFill').style.width = ((idx+1)/steps.length*100) + '%';
}

function saveCurrentInputs() {
    const s = steps[currentStep];
    s.inputs.forEach(inp => {
        const el = document.getElementById(inp.id);
        if (el) allValues[inp.id] = el.value;
    });
}

function nextStep() {
    saveCurrentInputs();

    // Calculate leak for current step
    if (currentStep > 0 || steps[currentStep].calc) {
        const result = steps[currentStep].calc(allValues);
        if (result.leak > 0) {
            leaks[currentStep] = result;
            recalcTotal();
        }
    }

    if (currentStep < steps.length - 1) {
        currentStep++;
        renderStep(currentStep);
    } else {
        showResults();
    }
}

function prevStep() {
    saveCurrentInputs();
    if (currentStep > 0) {
        currentStep--;
        renderStep(currentStep);
    }
}

function recalcTotal() {
    runningLeak = leaks.reduce((sum, l) => sum + (l ? l.leak : 0), 0);
    const el = document.getElementById('runningAmount');
    el.textContent = '$' + runningLeak.toLocaleString();
    el.style.transform = 'scale(1.1)';
    setTimeout(() => el.style.transform = 'scale(1)', 200);
}

function showResults() {
    document.getElementById('questionsContainer').style.display = 'none';
    document.getElementById('progressContainer').style.display = 'none';
    document.getElementById('runningTotal').style.display = 'none';
    document.getElementById('resultsPage').classList.add('active');

    const rawTotal = runningLeak;
    const rev = parseFloat(allValues.revenue) || 1;
    const maxCredible = rev * 0.04;
    const totalCapped = rawTotal > maxCredible;
    const total = totalCapped ? Math.round(maxCredible) : rawTotal;
    document.getElementById('finalTotal').textContent = '$' + total.toLocaleString();

    const pctOfRev = ((total / rev) * 100).toFixed(1);
    const perMonth = Math.round(total / 12).toLocaleString();
    const perDay = Math.round(total / 365).toLocaleString();

    const margin = rev * 0.05;
    const leakVsMargin = total > margin;

    let contextHtml = `That's <strong>${pctOfRev}% of your revenue</strong>. $${perMonth} per month. $${perDay} every single day. Most of it is recoverable.`;
    if (totalCapped) {
        contextHtml += `<div style="margin-top:1rem;padding:1rem;background:rgba(251,191,36,0.15);border:2px solid var(--accent2);border-radius:0.75rem;font-weight:600;color:var(--accent2);">Note: Your raw inputs suggest up to $${rawTotal.toLocaleString()} in leakage. We conservatively capped this at $${total.toLocaleString()} (4% of revenue) to keep the estimate realistic. Even at this conservative number, the recovery opportunity is significant.</div>`;
    }
    if (leakVsMargin) {
        contextHtml += `<div style="margin-top:1rem;padding:1rem;background:rgba(239,68,68,0.15);border:2px solid var(--accent);border-radius:0.75rem;font-weight:700;color:var(--accent);">Your estimated leakage ($${total.toLocaleString()}) EXCEEDS your estimated profit ($${Math.round(margin).toLocaleString()} at 5% margin). You may be leaking more than you're keeping.</div>`;
    }
    document.getElementById('totalContext').innerHTML = contextHtml;

    // Breakdown
    const validLeaks = leaks.filter(l => l && l.leak > 0).sort((a, b) => b.leak - a.leak);
    const maxLeak = validLeaks[0]?.leak || 1;
    document.getElementById('leaksBreakdown').innerHTML = validLeaks.map(l => `
        <div class="leak-row">
            <span class="name" style="min-width:140px">${l.label}</span>
            <div class="leak-bar-container"><div class="leak-bar" style="width:${(l.leak/maxLeak*100)}%"></div></div>
            <span class="val">$${l.leak.toLocaleString()}</span>
        </div>
    `).join('');
}

function handleDownload(e) {
    e.preventDefault();
    const firstName = document.getElementById('userFirst').value.trim();
    const lastName = document.getElementById('userLast').value.trim();
    const email = document.getElementById('userEmail').value.trim();
    if(!firstName||!lastName||!email) return;
    fetch('https://script.google.com/macros/s/AKfycbxH-0F_yuJve8Bvzf1WWqYc5Z0ptXRRktVCmLEEa-7Dbs3ear7cNESr6-Bmm8mQIJaZ/exec',{method:'POST',headers:{'Content-Type':'text/plain'},body:JSON.stringify({name:firstName+' '+lastName,email:email,tool:'Profit Leak Diagnostic',_subject:'New Lead: '+firstName+' '+lastName+' - Profit Leak Diagnostic',message:firstName+' '+lastName+' ('+email+') completed the Profit Leak Diagnostic and downloaded their PDF report.'})}).catch(function(){});
    const leads = JSON.parse(localStorage.getItem('profitleak_leads') || '[]');
    leads.push({ email, timestamp: new Date().toISOString(), total: runningLeak, leaks, inputs: allValues });
    localStorage.setItem('profitleak_leads', JSON.stringify(leads));
    generatePDF(email);
    document.getElementById('emailForm').style.display = 'none';
    document.getElementById('downloadComplete').classList.add('active');
}

function generatePDF(email) {
    const doc = new jsPDF();
    const pw = doc.internal.pageSize.getWidth();
    const ph = doc.internal.pageSize.getHeight();
    const m = 20, cw = pw - 2*m;
    let y = 0;

    const rev = parseFloat(allValues.revenue) || 1;
    const margin = rev * 0.05;
    const firstName = document.getElementById('userFirst').value.trim();
    const lastName = document.getElementById('userLast').value.trim();
    const userName = firstName + ' ' + lastName;

    // Sanity cap: if leakage exceeds 4% of revenue, cap it and flag
    const rawLeak = runningLeak;
    const maxCredibleLeak = rev * 0.04;
    const isCapped = rawLeak > maxCredibleLeak;
    const displayLeak = isCapped ? maxCredibleLeak : rawLeak;
    const leakVsMargin = displayLeak > margin;

    // Design system
    const C = {
        bg: [15, 15, 20],           // Dark background
        card: [25, 25, 35],         // Dark card
        cell: [35, 35, 45],         // Slightly lighter for nested elements
        border: [50, 50, 65],       // Subtle border
        text: [241, 245, 249],      // Light text
        textMid: [148, 163, 184],   // Muted text
        textLight: [100, 116, 139], // Dimmer text
        white: [255, 255, 255],
        shadow: [10, 10, 15],       // Dark shadow
        blue: [96, 165, 250],       // Brighter blue for dark bg
        red: [248, 113, 113],       // Brighter red
        yellow: [251, 191, 36],
        green: [74, 222, 128],      // Brighter green
        purple: [192, 132, 252],    // Brighter purple
        amber: [251, 191, 36]
    };

    const txt = (t,sz,st='normal',c=C.text) => { doc.setFontSize(sz); doc.setFont('helvetica',st); doc.setTextColor(...c); };
    const fill = (c) => doc.setFillColor(...c);
    const stroke = (c) => doc.setDrawColor(...c);

    // Fit text helper for dynamic sizing
    const fitText = (doc, text, maxWidth, startSize, minSize = 7.5) => {
        let sz = startSize;
        let lines;
        while (sz >= minSize) {
            doc.setFontSize(sz);
            lines = doc.splitTextToSize(text, maxWidth);
            if (lines.length <= 3) break;
            sz -= 0.5;
        }
        return { lines, fontSize: sz };
    };

    // Dynamic page break with real content height
    const cp = (contentHeight) => { 
        if(y + contentHeight > 265){
            newPage(); 
            return true;
        } 
        return false; 
    };

    const newPage = () => {
        doc.addPage();
        fill(C.bg); doc.rect(0,0,pw,ph,'F');
        fill(C.red); doc.rect(0,0,pw,1.5,'F');
        y = 20;
    };

    const card = (x,yc,w,h,opts={}) => {
        const r = opts.radius || 2;
        fill(C.shadow); doc.roundedRect(x+0.5,yc+0.5,w,h,r,r,'F');
        stroke(C.border); doc.setLineWidth(0.2);
        fill(C.card); doc.roundedRect(x,yc,w,h,r,r,'FD');
        if(opts.accent) { fill(opts.accent); doc.roundedRect(x,yc,3,h,r,0,'F'); doc.rect(x+1.5,yc,1.5,h,'F'); }
    };

    const secTitle = (title,yy,color=C.red) => {
        const titleFit = fitText(doc, title, cw, 12, 9);
        const titleHeight = titleFit.lines.length * 5 + 10;
        cp(titleHeight);
        txt('',titleFit.fontSize,'bold',C.text);
        doc.text(titleFit.lines,m,yy+7);
        fill(color); doc.rect(m,yy+titleHeight-3,25,1.5,'F');
        return yy + titleHeight;
    };

    // =============================
    // PAGE 1: COVER
    // =============================
    fill(C.bg); doc.rect(0,0,pw,ph,'F');
    
    // Header card with dynamic content
    const headerHeight = 72;
    fill(C.card); stroke(C.border); doc.roundedRect(0,-10,pw,headerHeight,0,0,'FD');
    fill(C.red); doc.circle(pw/2,16,7,'F');
    txt('A',10,'bold',C.white); doc.text('A',pw/2,19,{align:'center'});

    const titleFit = fitText(doc, 'PROFIT LEAK DIAGNOSTIC', cw, 20, 16);
    txt('',titleFit.fontSize,'bold',C.text);
    doc.text(titleFit.lines,pw/2,36,{align:'center'});
    
    const subtitleFit = fitText(doc, 'Your Personalized Recovery Plan', cw, 11, 8);
    txt('',subtitleFit.fontSize,'normal',C.textMid);
    doc.text(subtitleFit.lines,pw/2,46,{align:'center'});

    // Personalization line
    const preparedText = 'Prepared for: ' + userName;
    const preparedFit = fitText(doc, preparedText, cw, 10, 8);
    txt('',preparedFit.fontSize,'bold',C.amber);
    doc.text(preparedFit.lines,pw/2,52,{align:'center'});

    fill(C.bg); doc.roundedRect(pw/2-50,55,100,10,5,5,'F');
    txt(new Date().toLocaleDateString('en-US',{month:'long',day:'numeric',year:'numeric'}),8,'bold',C.textMid);
    doc.text(new Date().toLocaleDateString('en-US',{month:'long',day:'numeric',year:'numeric'}),pw/2,61.5,{align:'center'});

    y = headerHeight + 8;

    // Estimated leakage card - dynamic height
    const leakageTitleFit = fitText(doc, 'TOTAL ESTIMATED ANNUAL PROFIT LEAKAGE', cw-20, 9, 7);
    const amountText = '$' + Math.round(displayLeak).toLocaleString();
    const leakagePctText = `${((displayLeak/rev)*100).toFixed(1)}% of your annual revenue is leaking`;
    const leakagePctFit = fitText(doc, leakagePctText, cw-20, 10, 8);
    const leakageCardHeight = 15 + leakageTitleFit.lines.length * 5 + 20 + leakagePctFit.lines.length * 5 + 8;
    
    cp(leakageCardHeight);
    card(m,y,cw,leakageCardHeight,{accent:C.red});
    
    let cardY = y + 15;
    txt('',leakageTitleFit.fontSize,'bold',C.red);
    doc.text(leakageTitleFit.lines,m+cw/2,cardY,{align:'center'});
    cardY += leakageTitleFit.lines.length * 5;
    
    txt(amountText,32,'bold',C.red);
    doc.text(amountText,m+cw/2,cardY + 12,{align:'center'});
    cardY += 20;
    
    txt('',leakagePctFit.fontSize,'normal',C.textMid);
    doc.text(leakagePctFit.lines,m+cw/2,cardY,{align:'center'});
    
    y += leakageCardHeight + 8;

    // Breakdown metrics - dynamic sizing
    const metW = (cw-10)/3;
    const mets = [
        { val:'$'+Math.round(displayLeak/12).toLocaleString(), label:'PER MONTH', color:C.red },
        { val:'$'+Math.round(displayLeak/365).toLocaleString(), label:'PER DAY', color:C.amber },
        { val:((displayLeak/rev)*100).toFixed(1)+'%', label:'OF REVENUE', color:C.purple }
    ];
    
    let metricCardHeight = 10; // base height
    const metricFits = mets.map(mt => {
        const valFit = fitText(doc, mt.val, metW-10, 16, 12);
        const labelFit = fitText(doc, mt.label, metW-10, 7, 7);
        const thisHeight = 10 + valFit.lines.length * 8 + labelFit.lines.length * 4 + 8;
        metricCardHeight = Math.max(metricCardHeight, thisHeight);
        return { valFit, labelFit };
    });
    
    cp(metricCardHeight);
    mets.forEach((mt,i) => {
        const x = m + i*(metW+5);
        card(x,y,metW,metricCardHeight,{accent:mt.color});
        
        const mf = metricFits[i];
        let metY = y + 10;
        txt('',mf.valFit.fontSize,'bold',mt.color);
        doc.text(mf.valFit.lines,x+metW/2,metY,{align:'center'});
        metY += mf.valFit.lines.length * 8;
        
        txt('',mf.labelFit.fontSize,'bold',C.text);
        doc.text(mf.labelFit.lines,x+metW/2,metY,{align:'center'});
    });
    y += metricCardHeight + 8;

    // Nuclear insight card - dynamic
    if (leakVsMargin) {
        const warnTitleFit = fitText(doc, 'WARNING: LEAKAGE EXCEEDS PROFIT', cw-20, 10, 8);
        const warnMsg = isCapped
            ? `Based on your inputs, raw leakage estimates reached $${rawLeak.toLocaleString()}. We capped this at a conservative $${Math.round(displayLeak).toLocaleString()} (4% of revenue) to stay realistic. Even at this conservative estimate, you are leaking more than you are keeping ($${Math.round(margin).toLocaleString()} at 5% margin).`
            : `Your estimated leakage ($${Math.round(displayLeak).toLocaleString()}) EXCEEDS your estimated profit ($${Math.round(margin).toLocaleString()} at 5% margin). You may be leaking more than you are keeping.`;
        const warnMsgFit = fitText(doc, warnMsg, cw-30, 8, 7.5);
        const warnCardHeight = 11 + warnTitleFit.lines.length * 5 + 8 + warnMsgFit.lines.length * 5 + 8;
        
        cp(warnCardHeight);
        card(m,y,cw,warnCardHeight,{accent:C.red});
        stroke(C.red); doc.setLineWidth(0.8); doc.roundedRect(m,y,cw,warnCardHeight,2,2,'D');
        
        let warnY = y + 11;
        txt('',warnTitleFit.fontSize,'bold',C.red);
        doc.text(warnTitleFit.lines,m+cw/2,warnY,{align:'center'});
        warnY += warnTitleFit.lines.length * 5 + 8;
        
        txt('',warnMsgFit.fontSize,'normal',C.text);
        doc.text(warnMsgFit.lines,m+15,warnY);
        
        y += warnCardHeight + 8;
    }

    // Report outline card - dynamic
    const outlineItems = ['Leak Breakdown: where your profit is going, ranked by impact','Detailed Recovery Plans: step-by-step fixes with real metrics and timelines for each leak','Industry Benchmarks: how your leakage compares to distribution averages','90-Day Recovery Roadmap: phased plan with specific deliverables, milestones, and expected dollar recovery'];
    const outlineHeaderFit = fitText(doc, "WHAT'S IN THIS REPORT", cw-20, 10, 8);
    let outlineContentHeight = 12 + outlineHeaderFit.lines.length * 5 + 8;
    const outlineItemFits = outlineItems.map((item, i) => {
        const itemFit = fitText(doc, item, cw-40, 8, 7.5);
        outlineContentHeight += itemFit.lines.length * 5 + 2;
        return itemFit;
    });
    outlineContentHeight += 8; // bottom padding
    
    cp(outlineContentHeight);
    card(m,y,cw,outlineContentHeight);
    
    let outlineY = y + 12;
    txt('',outlineHeaderFit.fontSize,'bold',C.text);
    doc.text(outlineHeaderFit.lines,m+10,outlineY);
    outlineY += outlineHeaderFit.lines.length * 5 + 8;
    
    outlineItemFits.forEach((itemFit, i) => {
        fill(C.red); doc.circle(m+14,outlineY,1.5,'F');
        txt((i+1).toString(),6,'bold',C.white);
        doc.text((i+1).toString(),m+14,outlineY+1.5,{align:'center'});
        txt('',itemFit.fontSize,'normal',C.textMid);
        doc.text(itemFit.lines,m+20,outlineY+1.5);
        outlineY += itemFit.lines.length * 5 + 2;
    });
    y += outlineContentHeight + 8;

    // Leak breakdown section - dynamic
    const breakdownTitleHeight = 18;
    cp(breakdownTitleHeight);
    y = secTitle('WHERE YOUR PROFIT IS LEAKING', y);
    
    const validLeaks = leaks.filter(l=>l&&l.leak>0).sort((a,b)=>b.leak-a.leak);
    
    validLeaks.forEach((l,li) => {
        const leakLabelFit = fitText(doc, l.label, cw-100, 10, 8);
        const leakDescFit = fitText(doc, l.desc, cw-100, 8, 7.5);
        const amountText = '$'+l.leak.toLocaleString();
        const leakItemHeight = Math.max(22, 12 + leakLabelFit.lines.length * 5 + leakDescFit.lines.length * 4 + 8);
        
        cp(leakItemHeight);
        card(m,y,cw,leakItemHeight);
        
        fill(C.red); doc.circle(m+12,y+leakItemHeight/2,6,'F');
        txt((li+1).toString(),10,'bold',C.white);
        doc.text((li+1).toString(),m+12,y+leakItemHeight/2+3,{align:'center'});
        
        let leakY = y + 10;
        txt('',leakLabelFit.fontSize,'bold',C.text);
        doc.text(leakLabelFit.lines,m+25,leakY);
        leakY += leakLabelFit.lines.length * 5;
        
        txt('',leakDescFit.fontSize,'normal',C.textMid);
        doc.text(leakDescFit.lines,m+25,leakY);
        
        fill(C.red); doc.roundedRect(pw-m-45,y+6,35,10,5,5,'F');
        txt(amountText,9,'bold',C.white);
        doc.text(amountText,pw-m-27.5,y+12.5,{align:'center'});
        
        y += leakItemHeight + 6;
    });

    // =============================
    // PAGE 2+: RECOVERY PLANS
    // =============================
    newPage();
    y = secTitle('DETAILED RECOVERY PLAN', y);

    const fixes = {
        "Pricing Inconsistency": {
            priority:"CRITICAL", impact:"1-3% revenue recovery",
            steps:[
                "Pull your ERP's price override report for the last 90 days. Sort by rep. You will likely find 2-3 reps responsible for 60% of all overrides. Meet with them individually. Common finding: they are discounting to match a competitor they heard about secondhand. Fix: create a competitive price match workflow requiring the actual competitor quote. (Source: B2B distributors lose 2% to 11.7% of profit annually from inconsistent pricing, per SAP/Zilliant benchmark data.)",
                "Identify your top 10 SKUs by override frequency. These are the items where reps feel least confident in your pricing. Build a pricing matrix for these SKUs first: by customer tier, order volume, and contract status. At 18% gross margin, a 1% price improvement eliminates the need for a 6% sales increase to hit the same profit (McKinsey). Implementation time: 1 week.",
                "Set hard margin floors by product category in your ERP (e.g., commodity items 15%, specialty 25%, equipment 10%). Any order below the floor triggers a hold for manager review with a mandatory reason code. This single change typically recovers 0.5-1% of revenue within 30 days.",
                "Audit your customer-specific pricing agreements. Pull every contract with a custom price list. Check: are those agreements still active? Many distributors carry 200+ expired or outdated price agreements that reps default to. Cleaning these up alone recovers $50K-$150K annually for a $25M distributor.",
                "Deploy automated price updates from vendor cost feeds. Every day you sell at old cost while new cost is higher, you lose margin. Target: price updates within 48 hours of vendor notification, not the industry average of 2-4 weeks. Expected recovery: 0.3-0.8% of revenue."
            ]
        },
        "Order Processing Waste": {
            priority:"HIGH", impact:"50-70% labor cost reduction",
            steps:[
                "Time-study 20 orders end-to-end: from email/phone receipt to ERP entry to pick ticket to shipping confirmation. For a distributor processing 15,000 orders annually, manual entry typically costs $200,000-$350,000 per year in direct labor alone (Bizowie, 2025). Time each step. You will find the bottleneck in 30 minutes.",
                "Categorize your last 100 order errors by type: wrong SKU, wrong quantity, wrong ship-to, wrong pricing. Each error costs $120-$250 to resolve when you factor in return freight, restocking labor, replacement shipping, and customer goodwill credits. The top 3 error types will account for 80% of total error cost.",
                "Identify your reorder patterns. In most distributorships, 60-70% of orders are repeat purchases from existing customers. These are prime automation candidates. Deploy an order validation engine that flags orders deviating more than 20% from the customer's 90-day purchase history.",
                "Launch a customer self-service portal for repeat orders. Start with your top 20 accounts by order frequency. Give them access to their order history, saved carts, and real-time inventory. Target: move 30% of manual orders to self-service within 60 days. That alone saves 1-2 FTE equivalents.",
                "Implement email-to-order parsing for standard PO formats. Modern AI tools can extract line items from emailed POs with 95%+ accuracy. Your CSRs shift from data entry to exception handling only. Manual invoices take 15 minutes each; automated processing takes under 2 minutes (ResolvePay, 2025). Implementation time: 2-4 weeks."
            ]
        },
        "Slow Quote Response": {
            priority:"HIGH", impact:"20-35% higher win rate",
            steps:[
                "Measure your actual quote turnaround time. Timestamp every quote request and every response for 2 weeks. The average B2B response time is 42 hours (Harvard Business Review). If you are anywhere near that, you are losing deals before you even compete. The first business to respond wins 78% of the time (Oldroyd/MIT).",
                "Create pricing templates for your top 20 quote scenarios. In most distributorships, 80% of quote requests fall into repeatable patterns: same product categories, similar volumes, familiar customer types. Pre-build these with approved margin ranges so reps can send quotes in minutes, not hours.",
                "Enable auto-pricing for standard catalog items. When a rep selects customer tier + SKUs + quantity, the price should populate automatically from your matrix. No manager approval needed for standard pricing. Reserve human judgment for custom or high-value quotes only.",
                "Set a 2-hour response target for standard quotes and same-day for complex/custom. Responding within 5 minutes makes prospects 21x more likely to engage versus a 30-minute delay (HBR). Even in B2B distribution, speed signals competence and reliability.",
                "Track your quote-to-win ratio weekly by rep and by response time. You will see a direct correlation: quotes returned within 2 hours close at 2-3x the rate of next-day responses. Share this data with your team. Expected recovery: 15-25% improvement in quote conversion within 60 days."
            ]
        },
        "Inventory Mismanagement": {
            priority:"HIGH", impact:"25-35% carrying cost reduction",
            steps:[
                "Run an ABC analysis immediately. A-items (top 20% by revenue contribution) get daily monitoring and automated reorder triggers. B-items get weekly review. C-items get monthly review. The average business holds $142,000 in excess inventory above actual demand (Unleashed Software, 2025). For distributors, this number is often 3-5x higher.",
                "Check your inventory accuracy. The industry average is only 83% (Opensend, 2025). World-class operations hit 95%. If you are below 90%, every purchasing decision you make is based on flawed data. Start cycle counting A-items weekly, B-items monthly, C-items quarterly. Do not rely on annual physical counts.",
                "Pull your dead stock report: items with zero movement in 12+ months. In 2024, excess stock grew to 38% of SMB inventory (Unleashed). Price dead stock aggressively (50-70% off) and move it. The carrying cost alone (storage, insurance, capital) runs 20-30% of inventory value per year. A $100K pile of dead stock costs you $25K annually just to keep it.",
                "Set automated reorder points for A-items using this formula: (average daily sales x lead time in days) + safety stock. Pull 90-day velocity data from your ERP. Top-performing distributors maintain 18.7-day lead times versus 63.1 days for lagging operations (Anchor Group, 2025). Close that gap and you free up cash while improving fill rates.",
                "Deploy demand sensing for seasonal and promotional items. Use 3-year sales history by month to identify seasonal curves. Pre-position inventory 30 days before demand spikes. Stockouts cause 43% of B2B buyers to switch to a competitor (Orlio, 2025). Every stockout is a customer retention risk, not just a missed sale."
            ]
        },
        "Preventable Customer Churn": {
            priority:"MEDIUM", impact:"5-15% revenue protection",
            steps:[
                "Generate a declining customer report right now. Pull every account with a volume drop greater than 20% over the past 6 months. B2B distributors lose up to 15% of annual revenue to customer churn (SAP, 2024). Of that, roughly 30% is preventable with proactive intervention. For a $25M distributor, that is $1.1M in recoverable revenue.",
                "Call your top 10 declining accounts this week. Not an email. A phone call. Ask one question: 'We noticed your orders have slowed down. What changed?' Common answers: a competitor offered better pricing on 2-3 items (fixable), your delivery times slipped (fixable), they could not get a quote fast enough (fixable). You cannot fix what you do not know about.",
                "Set automated alerts in your ERP or CRM for accounts with no orders in 30, 60, and 90 days. At 30 days, trigger a rep notification. At 60 days, trigger a manager alert. At 90 days, flag for executive review. Acquiring a new customer costs 5-7x more than retaining an existing one. The math demands proactive monitoring.",
                "Institute quarterly business reviews for your top 20% of accounts by revenue. Bring data: their order trends, fill rate on their orders, average quote turnaround time. Show them you are paying attention. A 5% increase in retention can boost profits 25-95% (Bain & Company). These reviews take 30 minutes and protect your highest-value relationships.",
                "Launch a simple post-delivery survey: one question, one click. 'How was your last order experience? Great / OK / Problem.' Route 'Problem' responses to a manager within 1 hour. This costs almost nothing to implement and catches service failures before they become churn events. Track your Net Promoter Score monthly."
            ]
        },
        "Wasted Labor Hours": {
            priority:"MEDIUM", impact:"20-40% efficiency gain",
            steps:[
                "Survey your team with one question: 'What do you do every day that feels like a waste of time?' You will get 5-10 answers immediately. The average distributor employee spends 35-40% of their time on repetitive manual tasks. At $55K average salary, that is $45,000 per year per employee in manual process waste (2WTech, 2025). For a 12-person office, that is $540K annually.",
                "Map your top 5 time-wasting processes end to end. Common culprits in distribution: re-keying orders from email into ERP, manually creating invoices, copying data between systems for reporting, chasing approvals via email chains, and manually updating inventory counts after receiving. Time each one. You need the numbers to justify automation.",
                "Deploy automation for data re-entry between systems first. If your team copies data from your ERP to Excel for weekly reports, automate it. If they re-key PO data from emails into your order system, automate it. Each of these saves 5-15 hours per week. Only 23% of SMBs have invested in AI for operations (Anchor Group, 2025), so this is a competitive advantage.",
                "Automate your report generation. If anyone on your team spends more than 30 minutes per week building recurring reports (sales reports, inventory reports, AR aging), that should be automated and delivered to their inbox. Modern BI tools connect directly to your ERP. Setup time: 1-2 days per report. Payback: immediate.",
                "Reallocate saved hours explicitly. Do not just let people fill freed time with busywork. Assign recovered hours to customer-facing activities: proactive outreach to declining accounts, faster quote responses, quarterly business reviews. Every hour moved from data entry to customer service has a 3-5x ROI multiplier."
            ]
        },
        "Slow Price Pass-Through": {
            priority:"MEDIUM", impact:"0.3-1.2% margin protection",
            steps:[
                "Create a price change tracking log immediately. For every vendor price change, record: date received, date updated in your system, number of orders shipped at old margin during the gap. Most distributors take 2-4 weeks to pass through increases. At 18% gross margin, every day of delay on a 3% cost increase erodes your margin by roughly 0.05% of affected revenue. On $100K of daily volume, that is $50/day per vendor change.",
                "Set a 48-hour SLA for price updates on A-items (your top revenue drivers). These are the items where delay costs the most. For B and C items, allow 5 business days maximum. Assign one person as the price update owner. Do not spread this across the team; it falls through the cracks every time.",
                "Automate price feed integration wherever vendors offer electronic updates. Many major manufacturers now provide EDI or API-based price feeds. Connect these directly to your ERP pricing tables with a review-and-approve workflow. This eliminates the manual spreadsheet comparison that eats 4-8 hours per vendor change.",
                "Send proactive customer notifications when prices change. This sounds counterintuitive, but it builds trust and actually reduces customer churn. Frame it as: 'Heads up, costs on [category] are increasing [X%] effective [date]. Lock in current pricing on your next order.' This drives order volume in the short term and positions you as a transparent partner.",
                "Calculate your monthly margin erosion from delayed pass-throughs. Pull vendor cost change dates from your AP records, compare to the date you updated sell prices. Multiply the gap days by daily volume on affected SKUs by the margin delta. For most distributors, this number is $30K-$80K per year in pure margin loss. Closing that gap to 48 hours recovers 70-80% of it."
            ]
        }
    };

    validLeaks.forEach((leak, idx) => {
        const fix = fixes[leak.label];
        if(!fix) return;
        const col = fix.priority==="CRITICAL"?C.red:fix.priority==="HIGH"?C.amber:C.blue;
        
        // Measure all text content for dynamic height
        const headerFit = fitText(doc, `${idx+1}. ${leak.label.toUpperCase()}`, cw-30, 10, 8);
        const impactFit = fitText(doc, `Impact: ${fix.impact}`, cw/3, 8, 7.5);
        const priorityLabelFit = fitText(doc, 'PRIORITY:', 40, 8, 7.5);
        const priorityValueFit = fitText(doc, fix.priority, 60, 9, 7.5);
        
        // Calculate total height needed
        let totalHeight = 12; // top padding
        totalHeight += headerFit.lines.length * 5 + 6; // header + gap
        totalHeight += Math.max(impactFit.lines.length * 4, 10) + 4; // impact line + gap
        totalHeight += Math.max(priorityLabelFit.lines.length * 4 + priorityValueFit.lines.length * 5, 10) + 6; // priority line + gap
        
        const stepFits = fix.steps.map(s => fitText(doc, s, cw-35, 8, 7.5));
        stepFits.forEach(sf => {
            totalHeight += sf.lines.length * 5 + 3; // step text + gap
        });
        totalHeight += 8; // bottom padding
        
        cp(totalHeight);
        card(m,y,cw,totalHeight,{accent:col});
        
        // Draw content
        let currentY = y + 12;
        txt('',headerFit.fontSize,'bold',col);
        doc.text(headerFit.lines,m+12,currentY);
        currentY += headerFit.lines.length * 5 + 6;
        
        txt('',impactFit.fontSize,'bold',C.textMid);
        doc.text(impactFit.lines,pw-m-12,currentY,{align:'right'});
        
        txt('',priorityLabelFit.fontSize,'bold',C.text);
        doc.text(priorityLabelFit.lines,m+12,currentY);
        txt('',priorityValueFit.fontSize,'bold',col);
        doc.text(priorityValueFit.lines,m+35,currentY);
        currentY += Math.max(impactFit.lines.length * 4, priorityLabelFit.lines.length * 4 + priorityValueFit.lines.length * 5) + 6;
        
        stepFits.forEach(sf => {
            fill(col); doc.circle(m+15,currentY,1,'F');
            txt('',sf.fontSize,'normal',C.text);
            doc.text(sf.lines,m+20,currentY+1.5);
            currentY += sf.lines.length * 5 + 3;
        });
        
        y += totalHeight + 8;
    });

    // =============================
    // FINAL PAGES: ROADMAP + CTA
    // =============================
    newPage();
    y = secTitle('90-DAY PROFIT RECOVERY ROADMAP', y);
    
    const phases = [
        { t:'DAYS 1-14: AUDIT AND DISCOVER', c:C.green, items:[
            'Week 1: Pull ERP price override logs for 90 days. Sort by rep and SKU. Identify your top 3 override offenders and top 10 overridden SKUs. This takes 2 hours and reveals where 60%+ of margin erosion lives.',
            'Week 1: Generate your declining customer report (accounts down >20% in 6 months). Call the top 10 this week. One question: "What changed?" You will learn more in these calls than in any dashboard.',
            'Week 2: Block 3 hours on Monday to sit with your best CSR and watch them process 10 orders. Time each step with a stopwatch. You will find the bottleneck in 30 minutes. Common finding: 40% of time is spent re-keying data that already exists digitally.',
            'Week 2: Run your dead stock report (zero movement in 12+ months). Calculate carrying cost at 25% of value. This number will surprise you. Tag everything for liquidation.',
            'Deliverables: Price override audit, customer churn list, order process map with timestamps, dead stock inventory with carrying costs. Expected finding: $50K-$200K in immediately addressable leakage.'
        ]},
        { t:'DAYS 15-30: QUICK WINS', c:C.amber, items:[
            'Set hard margin floors in your ERP for top 50 SKUs by category. Any order below the floor requires manager approval with a reason code. This single change typically recovers 0.5-1% of revenue within 30 days. Your sales team will resist this. Show them the data: they are leaving money on the table, not the other way around.',
            'Create pricing templates for your top 20 quote scenarios. Pre-load approved margin ranges. Target: reps can send standard quotes in under 15 minutes instead of 4+ hours. The first responder wins 78% of deals (MIT/Oldroyd).',
            'Run ABC inventory analysis and set automated reorder points for A-items. Formula: (avg daily sales x lead time) + safety stock. Pull 90-day velocity from your ERP. This prevents both stockouts (43% of buyers switch to competitors) and overstocking.',
            'Liquidate dead stock aggressively: 50-70% off, bulk deals, clearance to loyal customers first. Every $100K of dead stock costs $25K/year just to hold.',
            'Roadblock warning: Your sales team will push back on pricing controls. Response: pull their personal override history and show them the margin they gave away. Frame it as "here is $X you could have earned in commission if you held price." That changes the conversation.',
            'Deliverables: Margin floors active, 20 quote templates live, A-item reorder points set, dead stock liquidation launched. Expected recovery: $30K-$80K annualized within 30 days.'
        ]},
        { t:'DAYS 31-60: SYSTEMS AND AUTOMATION', c:C.blue, items:[
            'Deploy order validation rules: flag any order deviating >20% from customer 90-day history. This catches wrong quantities, duplicate orders, and pricing errors before they ship. Error cost: $120-$250 per incident.',
            'Implement 48-hour SLA for vendor price pass-throughs on A-items. Assign one owner. Connect vendor EDI/API feeds where available. Every day of delay at 18% gross margin erodes profit on affected SKUs.',
            'Set up automated churn alerts: no-order triggers at 30, 60, and 90 days. Route to rep at 30 days, manager at 60, executive at 90. Acquiring a new customer costs 5-7x more than keeping one.',
            'Automate your top 3 time-wasting processes identified in the audit. Typical targets: ERP-to-Excel reporting, email PO parsing, and approval routing. Each saves 5-15 hours per week.',
            'Begin customer self-service portal pilot with your top 20 accounts by order frequency. Start with order history and reorder capability. Target: 30% of their orders move to self-service.',
            'Deliverables: Validation rules live, price SLA enforced, churn alerts active, 3 processes automated, portal pilot launched. Expected recovery: $80K-$150K annualized.'
        ]},
        { t:'DAYS 61-90: SCALE AND MEASURE', c:C.purple, items:[
            'Expand self-service portal to next 50 accounts. Each account moved to self-service saves 15-20 minutes per order in CSR time. At 3 orders/week per account, that is 37-50 hours/week freed up across 50 accounts.',
            'Calculate actual recovered profit vs. your Day 1 baseline. Pull: margin improvement from pricing controls, error reduction savings, quote win rate change, carrying cost reduction from inventory cleanup. Build a one-page scorecard.',
            'Institute quarterly business reviews for top 20% of accounts. Bring their data: order trends, fill rates, quote turnaround times. A 5% improvement in retention can boost profits 25-95% (Bain & Company). These 30-minute meetings protect your most valuable revenue.',
            'Reallocate freed labor hours explicitly. Move recovered time from data entry to customer-facing activities: proactive outreach, faster quotes, relationship building. Every hour shifted from admin to customer service has 3-5x ROI.',
            'Plan Phase 2: demand forecasting, dynamic pricing by customer segment, automated AP/AR matching, warehouse optimization. Phase 1 funds Phase 2.',
            'Deliverables: Full scorecard with dollar recovery, expanded portal, QBR program launched, labor reallocation plan. Expected total 90-day recovery: $150K-$400K annualized depending on revenue size.'
        ]}
    ];

    phases.forEach((p) => {
        const phaseTitleFit = fitText(doc, p.t, cw-20, 9, 7);
        
        let phaseContentHeight = 10 + phaseTitleFit.lines.length * 5 + 5; // header bar + gap
        const phaseItemFits = p.items.map(item => {
            const itemFit = fitText(doc, item, cw-20, 9, 7);
            phaseContentHeight += itemFit.lines.length * 5 + 3;
            return itemFit;
        });
        phaseContentHeight += 8; // bottom spacing
        
        cp(phaseContentHeight);
        fill(p.c); doc.roundedRect(m,y,cw,10,2,2,'F');
        txt('',phaseTitleFit.fontSize,'bold',C.white);
        doc.text(phaseTitleFit.lines,m+cw/2,y+7,{align:'center'});
        y += 15;
        
        phaseItemFits.forEach(itemFit => {
            fill(p.c); doc.circle(m+5,y+2,1,'F');
            txt('',itemFit.fontSize,'normal',C.text);
            doc.text(itemFit.lines,m+10,y+4);
            y += itemFit.lines.length * 5 + 3;
        });
        y += 8;
    });

    // =============================
    // INDUSTRY METRICS SECTION
    // =============================
    y += 5;
    y = secTitle('DISTRIBUTION PROFIT LEAK BENCHMARKS', y);

    const benchmarks = [
        { stat: '2-4%', desc: 'Average distributor net profit margin. At $25M revenue, your entire profit is $500K-$1M. A 1% pricing improvement = $250K straight to the bottom line.', src: 'NAW / McKinsey' },
        { stat: '2-11.7%', desc: 'Percentage of profit lost annually to inconsistent and misaligned pricing. At 18% gross margin, a 1% price gap requires 6% more sales volume to compensate.', src: 'SAP / Zilliant Benchmark Data' },
        { stat: '83%', desc: 'Average inventory accuracy across distribution businesses. World-class is 95%. That 12-point gap drives stockouts, over-ordering, and $142K in average excess inventory per business.', src: 'Opensend / Unleashed Software, 2025' },
        { stat: '78%', desc: 'Percentage of deals won by the first business to respond with a quote. Average B2B response time is 42 hours. Responding in 5 minutes makes prospects 21x more likely to engage.', src: 'MIT / Harvard Business Review' },
        { stat: '$200-350K', desc: 'Annual cost of manual order entry for a distributor processing 15,000 orders per year. Each order error costs $120-$250 to resolve including freight, restocking, and customer credits.', src: 'Bizowie / NAW, 2025' },
        { stat: '15%', desc: 'Annual revenue lost to customer churn in B2B distribution. Roughly 30% is preventable. A 5% improvement in retention can increase profits by 25-95%.', src: 'SAP / Bain & Company' }
    ];

    benchmarks.forEach((bm) => {
        const statFit = fitText(doc, bm.stat, 35, 16, 10);
        const descFit = fitText(doc, bm.desc, cw - 55, 8, 7.5);
        const srcFit = fitText(doc, 'Source: ' + bm.src, cw - 55, 7, 7);
        const bmHeight = Math.max(
            statFit.lines.length * 8 + 10,
            12 + descFit.lines.length * 4.5 + srcFit.lines.length * 3.5 + 8
        );

        cp(bmHeight);
        card(m, y, cw, bmHeight);

        // Stat on the left
        fill(C.red); doc.roundedRect(m + 6, y + 6, 38, bmHeight - 12, 3, 3, 'F');
        txt('', statFit.fontSize, 'bold', C.white);
        doc.text(statFit.lines, m + 25, y + bmHeight / 2 + 2, { align: 'center' });

        // Description on the right
        let bmY = y + 10;
        txt('', descFit.fontSize, 'normal', C.text);
        doc.text(descFit.lines, m + 50, bmY);
        bmY += descFit.lines.length * 4.5 + 2;
        txt('', srcFit.fontSize, 'italic', C.textLight);
        doc.text(srcFit.lines, m + 50, bmY);

        y += bmHeight + 5;
    });

    y += 5;

    // NOT AN ERP card - dynamic
    const notErpTitleFit = fitText(doc, 'THIS IS NOT AN ERP IMPLEMENTATION', cw-20, 10, 8);
    const notErpMsg = 'We build targeted automation on top of your existing systems. No 14-month projects. No rip-and-replace. Start seeing results in weeks, not years.';
    const notErpMsgFit = fitText(doc, notErpMsg, cw-30, 9, 7);
    const notErpHeight = 12 + notErpTitleFit.lines.length * 5 + 6 + notErpMsgFit.lines.length * 5 + 8;
    
    cp(notErpHeight);
    card(m,y,cw,notErpHeight,{accent:C.green});
    
    let notErpY = y + 12;
    txt('',notErpTitleFit.fontSize,'bold',C.green);
    doc.text(notErpTitleFit.lines,m+cw/2,notErpY,{align:'center'});
    notErpY += notErpTitleFit.lines.length * 5 + 6;
    
    txt('',notErpMsgFit.fontSize,'normal',C.text);
    doc.text(notErpMsgFit.lines,m+15,notErpY);
    
    y += notErpHeight + 10;

    // CTA - dynamic
    const ctaTitleFit = fitText(doc, "LET'S RECOVER YOUR PROFIT", cw-20, 14, 11);
    const ctaMsg = 'You have identified $' + Math.round(displayLeak).toLocaleString() + ' in annual profit leakage. Let us get it back.';
    const ctaMsg2 = 'Get your custom savings roadmap in 15 minutes. Yours to keep whether you work with us or not.';
    const ctaMsgFit = fitText(doc, ctaMsg, cw-30, 9, 7);
    const ctaMsg2Fit = fitText(doc, ctaMsg2, cw-30, 9, 7);
    const ctaLinkText = 'calendly.com/mo-deeplineop/30min';
    const ctaHeight = 15 + ctaTitleFit.lines.length * 6 + ctaMsgFit.lines.length * 5 + 6 + ctaMsg2Fit.lines.length * 5 + 8 + 12 + 6 + 10 + 8;
    
    cp(ctaHeight);
    stroke(C.red); doc.setLineWidth(1);
    fill(C.card); doc.roundedRect(m,y,cw,ctaHeight,3,3,'FD');
    
    let ctaY = y + 15;
    txt('',ctaTitleFit.fontSize,'bold',C.text);
    doc.text(ctaTitleFit.lines,pw/2,ctaY,{align:'center'});
    ctaY += ctaTitleFit.lines.length * 6;
    
    txt('',ctaMsgFit.fontSize,'normal',C.textMid);
    doc.text(ctaMsgFit.lines,pw/2,ctaY,{align:'center'});
    ctaY += ctaMsgFit.lines.length * 5 + 6;

    txt('',ctaMsg2Fit.fontSize,'normal',C.text);
    doc.text(ctaMsg2Fit.lines,pw/2,ctaY,{align:'center'});
    ctaY += ctaMsg2Fit.lines.length * 5 + 8;
    
    txt(ctaLinkText,12,'bold',C.red);
    doc.textWithLink(ctaLinkText,pw/2 - doc.getTextWidth(ctaLinkText)/2,ctaY,{url:'https://calendly.com/mo-deeplineop/30min'});
    ctaY += 10;
    
    const emailTxt = 'mo@deeplineop.ai';
    txt(emailTxt,9,'normal',C.textMid);
    doc.textWithLink(emailTxt,pw/2 - doc.getTextWidth(emailTxt)/2,ctaY,{url:'mailto:mo@deeplineop.ai'});

    // Footer
    const pc = doc.internal.getNumberOfPages();
    for(let i=1;i<=pc;i++){
        doc.setPage(i);
        fill(C.card); stroke(C.border); doc.rect(0,ph-12,pw,12,'FD');
        txt('Deep Line Operations | AI Automation for Distributors',7,'normal',C.textMid);
        doc.text('Deep Line Operations | AI Automation for Distributors',m,ph-5);
        txt(`Page ${i} of ${pc}`,7,'normal',C.textMid);
        doc.text(`Page ${i} of ${pc}`,pw-m,ph-5,{align:'right'});
    }
    doc.save('Profit-Leak-Diagnostic-Report.pdf');
}


init();
</script>
<!-- Navigation Menu --><div id="nav-menu" style="position:fixed;top:16px;right:16px;z-index:10000;font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,sans-serif;">
    <button id="nav-toggle" style="background:#12121a;border:1px solid #2a2a3a;color:#f1f5f9;padding:8px 14px;border-radius:8px;cursor:pointer;font-weight:600;display:flex;align-items:center;gap:8px;box-shadow:0 4px 12px rgba(0,0,0,0.5);font-size:14px;">
        <svg width="18" height="18" viewBox="0 0 18 18" fill="none"><rect y="3" width="18" height="2" rx="1" fill="#f1f5f9"/><rect y="8" width="18" height="2" rx="1" fill="#f1f5f9"/><rect y="13" width="18" height="2" rx="1" fill="#f1f5f9"/></svg>
        Tools
    </button>
    <div id="nav-content" style="display:none;position:absolute;top:48px;right:0;background:#12121a;border:1px solid #2a2a3a;border-radius:12px;width:270px;padding:8px;box-shadow:0 8px 24px rgba(0,0,0,0.7);">
        <a href="index.html" style="display:flex;align-items:center;gap:10px;padding:10px 12px;color:#f1f5f9;text-decoration:none;border-radius:6px;font-size:14px;border-left:3px solid #6366f1;background:rgba(99,102,241,0.08);margin-bottom:4px;">
            <img src="logo-icon.png" alt="" style="height:18px;width:18px;object-fit:contain;">
            <strong>All Tools</strong>
        </a>
        <div style="height:1px;background:#2a2a3a;margin:6px 4px;"></div>
        <a href="business-dependency.html" class="nav-link" data-color="#3b82f6" style="display:flex;align-items:center;gap:10px;padding:9px 12px;color:#94a3b8;text-decoration:none;border-radius:6px;font-size:13px;">
            <svg width="18" height="18" viewBox="0 0 18 18" fill="none"><path d="M9 2l6 4v6l-6 4-6-4V6l6-4z" stroke="#3b82f6" stroke-width="1.5" stroke-linejoin="round"/><circle cx="9" cy="9" r="2" fill="#3b82f6"/></svg>
            Business Dependency
        </a>
        <a href="ceo-time-audit.html" class="nav-link" data-color="#f59e0b" style="display:flex;align-items:center;gap:10px;padding:9px 12px;color:#94a3b8;text-decoration:none;border-radius:6px;font-size:13px;">
            <svg width="18" height="18" viewBox="0 0 18 18" fill="none"><rect x="2" y="3" width="14" height="12" rx="2" stroke="#f59e0b" stroke-width="1.5"/><path d="M2 7h14M6 3v-1M12 3v-1" stroke="#f59e0b" stroke-width="1.5" stroke-linecap="round"/><rect x="5" y="9" width="2" height="2" rx=".5" fill="#f59e0b"/><rect x="8" y="9" width="2" height="2" rx=".5" fill="#f59e0b"/></svg>
            CEO Time Audit
        </a>
        <a href="profit-leak-diagnostic.html" class="nav-link" data-color="#ef4444" style="display:flex;align-items:center;gap:10px;padding:9px 12px;color:#94a3b8;text-decoration:none;border-radius:6px;font-size:13px;">
            <svg width="18" height="18" viewBox="0 0 18 18" fill="none"><circle cx="9" cy="9" r="7.5" stroke="#ef4444" stroke-width="1.5"/><path d="M9 5v5l3 2" stroke="#ef4444" stroke-width="1.5" stroke-linecap="round"/><path d="M12 3l2-1M6 3L4 2" stroke="#ef4444" stroke-width="1.2" stroke-linecap="round"/></svg>
            Profit Leak Diagnostic
        </a>
        <a href="ai-readiness-scorecard.html" class="nav-link" data-color="#a855f7" style="display:flex;align-items:center;gap:10px;padding:9px 12px;color:#94a3b8;text-decoration:none;border-radius:6px;font-size:13px;">
            <svg width="18" height="18" viewBox="0 0 18 18" fill="none"><rect x="1" y="1" width="16" height="16" rx="3" stroke="#a855f7" stroke-width="1.5"/><path d="M5 12V8M9 12V5M13 12V9" stroke="#a855f7" stroke-width="2" stroke-linecap="round"/></svg>
            Process Quality Audit
        </a>
        <a href="reorder-calculator.html" class="nav-link" data-color="#22c55e" style="display:flex;align-items:center;gap:10px;padding:9px 12px;color:#94a3b8;text-decoration:none;border-radius:6px;font-size:13px;">
            <svg width="18" height="18" viewBox="0 0 18 18" fill="none"><rect x="2" y="6" width="14" height="10" rx="2" stroke="#22c55e" stroke-width="1.5"/><path d="M6 6V4a3 3 0 016 0v2" stroke="#22c55e" stroke-width="1.5"/><circle cx="9" cy="11" r="1.5" fill="#22c55e"/></svg>
            Reorder Calculator
        </a>
    </div>
</div>
<script>
(function(){
    var tgl=document.getElementById('nav-toggle'),cnt=document.getElementById('nav-content');
    if(!tgl||!cnt)return;
    tgl.onclick=function(e){e.stopPropagation();var v=cnt.style.display==='block';cnt.style.display=v?'none':'block';tgl.style.background=v?'#12121a':'#1a1a25';};
    document.addEventListener('click',function(){cnt.style.display='none';tgl.style.background='#12121a';});
    cnt.onclick=function(e){e.stopPropagation();};
    var links=document.querySelectorAll('.nav-link');
    links.forEach(function(l){
        l.onmouseenter=function(){l.style.background='rgba(255,255,255,0.06)';l.style.color='#f1f5f9';};
        l.onmouseleave=function(){if(!l.classList.contains('nav-active')){l.style.background='';l.style.color='#94a3b8';}};
    });
    var cur=window.location.pathname.split('/').pop()||'index.html';
    document.querySelectorAll('#nav-content a').forEach(function(a){
        if(a.getAttribute('href')===cur||(cur===''&&a.getAttribute('href')==='index.html')){
            a.classList.add('nav-active');a.style.background='rgba(255,255,255,0.1)';a.style.color='#fff';a.style.fontWeight='600';
        }
    });
})();
</script>
</body>
</html>
