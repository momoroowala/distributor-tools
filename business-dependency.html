<!DOCTYPE html>
<html lang="en">
<head>
    <link rel="icon" type="image/svg+xml" href="favicon.svg">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Business Dependency Score | What If You Left Tomorrow?</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <style>
        *{margin:0;padding:0;box-sizing:border-box}
        :root{--bg-primary:#0a0a0f;--bg-secondary:#12121a;--bg-tertiary:#1a1a25;--accent:#3b82f6;--accent-hover:#60a5fa;--accent-light:rgba(59,130,246,0.1);--text-primary:#f1f5f9;--text-secondary:#94a3b8;--text-muted:#64748b;--border:#2a2a3a;--success:#22c55e;--warning:#f59e0b;--danger:#ef4444}
        body{font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,sans-serif;background:var(--bg-primary);color:var(--text-primary);min-height:100vh;line-height:1.6}
        .container{max-width:700px;margin:0 auto;padding:2rem}
        header{text-align:center;margin-bottom:2rem;padding-top:2rem}
        .badge{display:inline-block;background:var(--accent);color:white;padding:0.25rem 0.75rem;border-radius:9999px;font-size:0.75rem;font-weight:600;text-transform:uppercase;letter-spacing:0.05em;margin-bottom:1rem}
        h1{font-size:2.1rem;font-weight:700;margin-bottom:0.75rem;background:linear-gradient(135deg,var(--text-primary),var(--accent));-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text}
        .subtitle{color:var(--text-secondary);font-size:1.05rem;max-width:530px;margin:0 auto}
        .scenario-box{background:var(--bg-secondary);border:1px solid var(--danger);border-radius:1rem;padding:1.5rem;margin-bottom:2rem;text-align:center}
        .scenario-box .icon{font-size:2rem;margin-bottom:0.5rem}
        .scenario-box p{color:var(--text-secondary);font-size:0.95rem}
        .scenario-box strong{color:var(--danger)}
        .progress-container{background:var(--bg-secondary);border:1px solid var(--border);border-radius:1rem;padding:1.25rem 1.5rem;margin-bottom:1.5rem}
        .progress-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:0.5rem}
        .progress-label{font-size:0.8rem;color:var(--text-muted)}
        .progress-count{font-size:0.8rem;color:var(--accent);font-weight:600}
        .progress-bar{height:6px;background:var(--bg-tertiary);border-radius:9999px;overflow:hidden}
        .progress-fill{height:100%;background:linear-gradient(90deg,var(--accent),var(--accent-hover));border-radius:9999px;transition:width 0.3s}
        .q-card{background:var(--bg-secondary);border:1px solid var(--border);border-radius:1rem;padding:2rem;display:none}
        .q-card.active{display:block;animation:slideIn 0.3s ease}
        @keyframes slideIn{from{opacity:0;transform:translateX(20px)}to{opacity:1;transform:translateX(0)}}
        .q-category{display:inline-block;background:var(--accent-light);color:var(--accent);padding:0.2rem 0.6rem;border-radius:0.25rem;font-size:0.7rem;font-weight:600;text-transform:uppercase;letter-spacing:0.05em;margin-bottom:0.75rem}
        .q-text{font-size:1.15rem;font-weight:600;margin-bottom:1.25rem;line-height:1.35}
        .options{display:flex;flex-direction:column;gap:0.75rem}
        .option{background:var(--bg-tertiary);border:2px solid var(--border);border-radius:0.75rem;padding:1rem 1.25rem;cursor:pointer;transition:all 0.2s;display:flex;align-items:center;gap:1rem}
        .option:hover{border-color:var(--accent);background:var(--accent-light)}
        .option.selected{border-color:var(--accent);background:var(--accent-light)}
        .option-indicator{width:22px;height:22px;border:2px solid var(--border);border-radius:50%;flex-shrink:0;display:flex;align-items:center;justify-content:center;transition:all 0.2s}
        .option.selected .option-indicator{background:var(--accent);border-color:var(--accent)}
        .option.selected .option-indicator::after{content:'';width:8px;height:8px;background:white;border-radius:50%}
        .option-text{font-size:0.95rem}
        .risk-tag{font-size:0.7rem;padding:0.15rem 0.5rem;border-radius:9999px;margin-left:auto;flex-shrink:0}
        .risk-tag.high{background:rgba(239,68,68,0.2);color:var(--danger)}
        .risk-tag.medium{background:rgba(245,158,11,0.2);color:var(--warning)}
        .risk-tag.low{background:rgba(34,197,94,0.2);color:var(--success)}
        .nav-buttons{display:flex;gap:1rem;margin-top:1.5rem}
        .btn{flex:1;padding:0.875rem 1.25rem;border-radius:0.5rem;font-weight:600;font-size:0.95rem;cursor:pointer;transition:all 0.2s;border:none}
        .btn-primary{background:var(--accent);color:white}
        .btn-primary:hover{background:var(--accent-hover)}
        .btn-secondary{background:var(--bg-tertiary);color:var(--text-secondary);border:1px solid var(--border)}
        .btn-secondary:hover{background:var(--border);color:var(--text-primary)}
        .btn:disabled{opacity:0.5;cursor:not-allowed}
        /* Results */
        .results-page{display:none}
        .results-page.active{display:block;animation:fadeIn 0.4s ease}
        @keyframes fadeIn{from{opacity:0;transform:translateY(20px)}to{opacity:1;transform:translateY(0)}}
        .score-card{background:var(--bg-secondary);border:1px solid var(--border);border-radius:1rem;padding:2.5rem;text-align:center;margin-bottom:2rem}
        .gauge{width:180px;height:90px;margin:0 auto 1rem;position:relative;overflow:hidden}
        .gauge-bg{width:180px;height:90px;border-radius:90px 90px 0 0;background:conic-gradient(from 0.75turn at 50% 100%,var(--success) 0%,var(--warning) 40%,var(--danger) 80%);position:absolute;top:0}
        .gauge-needle{width:4px;height:80px;background:white;position:absolute;bottom:0;left:50%;transform-origin:bottom center;transform:translateX(-50%) rotate(-90deg);transition:transform 1s ease;border-radius:2px}
        .gauge-center{width:20px;height:20px;background:var(--bg-secondary);border-radius:50%;position:absolute;bottom:-5px;left:50%;transform:translateX(-50%);border:3px solid white}
        .score-number{font-size:3rem;font-weight:700;line-height:1}
        .score-label{font-size:0.85rem;color:var(--text-muted);margin-top:0.25rem}
        .score-verdict{font-size:1.4rem;font-weight:600;margin-top:0.75rem}
        .score-desc{color:var(--text-secondary);max-width:450px;margin:0.5rem auto 0;font-size:0.95rem}
        .risk-grid{display:grid;grid-template-columns:repeat(2,1fr);gap:1rem;margin-bottom:2rem}
        .risk-card{background:var(--bg-secondary);border:1px solid var(--border);border-radius:0.75rem;padding:1.25rem}
        .risk-card h4{font-size:0.85rem;color:var(--text-muted);margin-bottom:0.5rem;text-transform:uppercase;letter-spacing:0.05em}
        .risk-card .score{font-size:1.75rem;font-weight:700;line-height:1}
        .risk-card .detail{font-size:0.8rem;color:var(--text-secondary);margin-top:0.25rem}
        .scenarios{background:var(--bg-secondary);border:1px solid var(--border);border-radius:1rem;padding:2rem;margin-bottom:2rem}
        .scenarios h3{font-size:1.1rem;margin-bottom:1rem}
        .scenario-item{padding:1rem;background:var(--bg-tertiary);border-radius:0.75rem;margin-bottom:0.75rem}
        .scenario-item:last-child{margin-bottom:0}
        .scenario-item h4{font-size:0.95rem;margin-bottom:0.25rem}
        .scenario-item p{font-size:0.85rem;color:var(--text-secondary)}
        .download-section{background:linear-gradient(135deg,var(--accent-light),var(--bg-secondary));border:2px solid var(--accent);border-radius:1rem;padding:2.5rem;text-align:center;margin-bottom:2rem}
        .download-section h3{font-size:1.4rem;margin-bottom:0.5rem}
        .download-section>p{color:var(--text-secondary);margin-bottom:1.5rem}
        .download-features{display:flex;justify-content:center;gap:1.5rem;margin-bottom:1.5rem;flex-wrap:wrap}
        .download-feature{display:flex;align-items:center;gap:0.4rem;font-size:0.85rem;color:var(--text-secondary)}
        .download-feature .icon{color:var(--success)}
        .email-form{display:flex;gap:0.75rem;max-width:450px;margin:0 auto;flex-wrap:wrap}
        .email-form input[type="email"]{flex:1;min-width:200px;padding:0.875rem 1rem;background:var(--bg-primary);border:1px solid var(--border);border-radius:0.5rem;color:var(--text-primary);font-size:1rem}
        .email-form input:focus{outline:none;border-color:var(--accent)}
        .email-form .btn{flex:none;min-width:180px}
        .download-complete{display:none;color:var(--success);padding:1rem;font-size:1rem}
        .download-complete.active{display:block}
        footer{text-align:center;padding:2rem;color:var(--text-muted);font-size:0.875rem}
        footer a{color:var(--accent);text-decoration:none}
        @media(max-width:640px){.container{padding:1rem}h1{font-size:1.65rem}.score-number{font-size:2.25rem}.risk-grid{grid-template-columns:1fr}}
    </style>
</head>
<body>
<div class="container">
    <header>
    <link rel="icon" type="image/svg+xml" href="favicon.svg">
        <span class="badge">Free Assessment</span>
        <h1>What If You Left Tomorrow?</h1>
        <p class="subtitle">How long would your business survive without you? This 10-question assessment reveals your single points of failure.</p>
    </header>

    <div class="scenario-box">
        <div class="icon">⚠️</div>
        <p>Imagine you had a medical emergency and <strong>couldn't work for 30 days</strong>. What would happen to your business? Let's find out.</p>
    </div>

    <div class="progress-container" id="progressContainer">
        <div class="progress-header">
            <span class="progress-label">Assessment Progress</span>
            <span class="progress-count"><span id="currentQ">1</span> of <span id="totalQ">10</span></span>
        </div>
        <div class="progress-bar"><div class="progress-fill" id="progressFill" style="width:10%"></div></div>
    </div>

    <div id="questionsContainer"></div>

    <div class="results-page" id="resultsPage">
        <div class="score-card">
            <div class="gauge" id="gauge">
                <div class="gauge-bg"></div>
                <div class="gauge-needle" id="needle"></div>
                <div class="gauge-center"></div>
            </div>
            <div class="score-number" id="totalScore">0</div>
            <div class="score-label">Owner Dependency Index (out of 100)</div>
            <div class="score-verdict" id="verdict"></div>
            <div class="score-desc" id="verdictDesc"></div>
        </div>

        <div class="risk-grid" id="riskGrid"></div>

        <div class="scenarios" id="scenariosSection">
            <h3>What Would Actually Happen</h3>
            <div id="scenariosList"></div>
        </div>

        <div class="download-section">
            <h3>📄 Get Your Independence Roadmap</h3>
            <p>Download a detailed PDF with specific steps to reduce your dependency score, build a business that runs without you, and create real freedom.</p>
            <div class="download-features">
                <div class="download-feature"><span class="icon">✓</span><span>Risk-by-risk action plan</span></div>
                <div class="download-feature"><span class="icon">✓</span><span>Succession readiness checklist</span></div>
                <div class="download-feature"><span class="icon">✓</span><span>90-day freedom roadmap</span></div>
            </div>
            <form class="email-form" id="emailForm" onsubmit="handleDownload(event)" style="flex-direction:column;align-items:stretch;max-width:420px;margin:0 auto;gap:0.5rem;">
                <div style="display:flex;gap:0.5rem;width:100%;">
                    <input type="text" id="userFirst" placeholder="First name" required style="flex:1;padding:0.75rem;background:var(--bg);border:1px solid var(--border);border-radius:0.5rem;color:var(--text);font-size:0.95rem;">
                    <input type="text" id="userLast" placeholder="Last name" required style="flex:1;padding:0.75rem;background:var(--bg);border:1px solid var(--border);border-radius:0.5rem;color:var(--text);font-size:0.95rem;">
                </div>
                <input type="email" id="userEmail" placeholder="Work email" required style="width:100%;padding:0.75rem;background:var(--bg);border:1px solid var(--border);border-radius:0.5rem;color:var(--text);font-size:0.95rem;">
                <button type="submit" class="btn btn-primary">Download PDF Report</button>
            </form>
            <div class="download-complete" id="downloadComplete">✓ Report downloaded! Check your downloads folder.</div>
        </div>
    </div>
    <footer><p>Built by <a href="#">Mo Roowala</a> | AI Automation for Distributors</p></footer>
</div>
<script>
const { jsPDF } = window.jspdf;

const questions = [
    {
        category: "Operations",
        question: "If you didn't show up for a week, could orders still ship correctly?",
        options: [
            { text: "No, I approve most orders or handle key accounts personally", score: 10, risk: "high" },
            { text: "Some would, but big orders would stall", score: 6, risk: "medium" },
            { text: "Yes, my team handles day-to-day order flow", score: 2, risk: "low" }
        ]
    },
    {
        category: "Pricing",
        question: "Does anyone else know your top customers' special pricing arrangements?",
        options: [
            { text: "No, it's mostly in my head or my email", score: 10, risk: "high" },
            { text: "Some is documented, but I'm the final authority", score: 6, risk: "medium" },
            { text: "Yes, pricing rules are in our system and team knows them", score: 2, risk: "low" }
        ]
    },
    {
        category: "Knowledge",
        question: "How much critical business knowledge exists only in your head?",
        options: [
            { text: "A lot: supplier contacts, customer history, process workarounds", score: 10, risk: "high" },
            { text: "Some things, but key processes are documented", score: 5, risk: "medium" },
            { text: "Very little, we've documented everything important", score: 1, risk: "low" }
        ]
    },
    {
        category: "Decisions",
        question: "How many daily decisions require your personal approval?",
        options: [
            { text: "Most: pricing, purchasing, hiring, complaints, exceptions", score: 10, risk: "high" },
            { text: "Several key ones, team handles the routine stuff", score: 5, risk: "medium" },
            { text: "Very few, I've empowered my team with clear guidelines", score: 1, risk: "low" }
        ]
    },
    {
        category: "Relationships",
        question: "How many of your top 10 customers have a relationship with your company beyond just you?",
        options: [
            { text: "Most call me directly for everything", score: 10, risk: "high" },
            { text: "Half have other contacts, half rely on me", score: 5, risk: "medium" },
            { text: "All of them work with my team; I'm involved strategically", score: 1, risk: "low" }
        ]
    },
    {
        category: "Financial",
        question: "Could your business get a bank loan or be acquired based on documented processes and systems?",
        options: [
            { text: "Honestly, no. It runs on tribal knowledge and relationships", score: 10, risk: "high" },
            { text: "Partially. Some things are documented, but gaps exist", score: 5, risk: "medium" },
            { text: "Yes, we have SOPs, documented systems, and transferable processes", score: 1, risk: "low" }
        ]
    },
    {
        category: "Suppliers",
        question: "Could your team handle a major supplier price change or disruption without you?",
        options: [
            { text: "No, I negotiate everything and make all supplier decisions", score: 10, risk: "high" },
            { text: "For routine changes yes, but crises need me", score: 5, risk: "medium" },
            { text: "Yes, we have processes and backup plans documented", score: 1, risk: "low" }
        ]
    },
    {
        category: "Technology",
        question: "If a key system went down, who would fix it or manage the crisis?",
        options: [
            { text: "Me. I'm the only one who understands how everything connects", score: 10, risk: "high" },
            { text: "We have some IT support, but I'd need to guide them", score: 5, risk: "medium" },
            { text: "Our IT team or vendor handles it with documented procedures", score: 1, risk: "low" }
        ]
    },
    {
        category: "Team",
        question: "Is there someone who could step in as acting leader for 30 days?",
        options: [
            { text: "No one could fill my role, even temporarily", score: 10, risk: "high" },
            { text: "Someone could handle basics, but not the full scope", score: 5, risk: "medium" },
            { text: "Yes, I have a capable #2 who knows the business well", score: 1, risk: "low" }
        ]
    },
    {
        category: "Growth",
        question: "Could your business grow 20% next year if you stepped back to part-time?",
        options: [
            { text: "Impossible. I AM the growth engine", score: 10, risk: "high" },
            { text: "It would plateau, but not collapse", score: 5, risk: "medium" },
            { text: "Yes, the systems and team could drive growth without me", score: 1, risk: "low" }
        ]
    }
];

let currentQuestion = 0;
let answers = [];

function init() {
    document.getElementById('totalQ').textContent = questions.length;
    renderQuestion(0);
}

function renderQuestion(idx) {
    const q = questions[idx];
    const container = document.getElementById('questionsContainer');
    container.innerHTML = `
        <div class="q-card active">
            <span class="q-category">${q.category}</span>
            <h2 class="q-text">${q.question}</h2>
            <div class="options">
                ${q.options.map((o,i) => `
                    <div class="option" onclick="selectOption(${i})" data-idx="${i}">
                        <div class="option-indicator"></div>
                        <span class="option-text">${o.text}</span>
                        <span class="risk-tag ${o.risk}">${o.risk} risk</span>
                    </div>
                `).join('')}
            </div>
            <div class="nav-buttons">
                <button class="btn btn-secondary" onclick="prevQ()" ${idx===0?'disabled':''}>← Back</button>
                <button class="btn btn-primary" onclick="nextQ()" id="nextBtn" disabled>${idx===questions.length-1?'See My Score':'Next →'}</button>
            </div>
        </div>`;

    if (answers[idx] !== undefined) {
        document.querySelectorAll('.option')[answers[idx].optionIndex].classList.add('selected');
        document.getElementById('nextBtn').disabled = false;
    }
    document.getElementById('currentQ').textContent = idx + 1;
    document.getElementById('progressFill').style.width = ((idx+1)/questions.length*100) + '%';
}

function selectOption(optIdx) {
    document.querySelectorAll('.option').forEach(o => o.classList.remove('selected'));
    document.querySelectorAll('.option')[optIdx].classList.add('selected');
    const q = questions[currentQuestion];
    answers[currentQuestion] = {
        optionIndex: optIdx,
        score: q.options[optIdx].score,
        risk: q.options[optIdx].risk,
        category: q.category,
        question: q.question,
        answer: q.options[optIdx].text
    };
    document.getElementById('nextBtn').disabled = false;
}

function nextQ() {
    if (currentQuestion < questions.length-1) { currentQuestion++; renderQuestion(currentQuestion); }
    else showResults();
}

function prevQ() {
    if (currentQuestion > 0) { currentQuestion--; renderQuestion(currentQuestion); }
}

function showResults() {
    document.getElementById('questionsContainer').style.display = 'none';
    document.getElementById('progressContainer').style.display = 'none';
    document.querySelector('.scenario-box').style.display = 'none';
    document.getElementById('resultsPage').classList.add('active');

    const totalScore = answers.reduce((s,a) => s+a.score, 0);
    document.getElementById('totalScore').textContent = totalScore;

    // Gauge needle
    const needleAngle = -90 + (totalScore/100)*180;
    setTimeout(() => {
        document.getElementById('needle').style.transform = `translateX(-50%) rotate(${needleAngle}deg)`;
    }, 200);

    let verdict, verdictDesc, scoreColor;
    if (totalScore >= 80) {
        verdict = "Your business can't survive without you";
        verdictDesc = "You don't own a business. You own a job you can never leave. Every major function depends on you personally.";
        scoreColor = [239,68,68];
    } else if (totalScore >= 60) {
        verdict = "High dependency, major risks";
        verdictDesc = "Your business would struggle significantly within days of your absence. Several critical functions have no backup.";
        scoreColor = [245,158,11];
    } else if (totalScore >= 40) {
        verdict = "Moderate dependency, some risks";
        verdictDesc = "Your team could keep things running short-term, but growth would stop and problems would pile up.";
        scoreColor = [245,158,11];
    } else {
        verdict = "Well-built, low dependency";
        verdictDesc = "Your business has strong systems and capable people. You could step back and it would continue to operate.";
        scoreColor = [34,197,94];
    }

    const verdictEl = document.getElementById('verdict');
    verdictEl.textContent = verdict;
    verdictEl.style.color = `rgb(${scoreColor.join(',')})`;
    document.getElementById('totalScore').style.color = `rgb(${scoreColor.join(',')})`;
    document.getElementById('verdictDesc').textContent = verdictDesc;

    // Risk categories
    const cats = {};
    answers.forEach(a => {
        if (!cats[a.category]) cats[a.category] = {total:0,count:0,risks:[]};
        cats[a.category].total += a.score;
        cats[a.category].count++;
        cats[a.category].risks.push(a);
    });

    const riskGrid = document.getElementById('riskGrid');
    riskGrid.innerHTML = Object.entries(cats).map(([cat,data]) => {
        const avg = data.total / data.count;
        const color = avg >= 8 ? 'var(--danger)' : avg >= 4 ? 'var(--warning)' : 'var(--success)';
        const level = avg >= 8 ? 'Critical' : avg >= 4 ? 'At Risk' : 'Healthy';
        return `<div class="risk-card">
            <h4>${cat}</h4>
            <div class="score" style="color:${color}">${level}</div>
            <div class="detail">${data.risks[0].answer.substring(0,60)}...</div>
        </div>`;
    }).join('');

    // Scenarios
    const highRisks = answers.filter(a => a.score >= 8);
    const scenariosList = document.getElementById('scenariosList');
    
    const scenarioTexts = {
        Operations: { title: "Orders would stall or ship wrong", desc: "Without you approving and overseeing, order accuracy drops and key accounts don't get their special handling. Within a week, your biggest customers start calling." },
        Pricing: { title: "Margin would hemorrhage", desc: "Nobody knows the special pricing arrangements. Reps either overprice (losing deals) or underprice (losing margin). Either way, money walks out the door." },
        Knowledge: { title: "Institutional knowledge would be lost", desc: "All those supplier workarounds, customer preferences, and process shortcuts that only you know? Gone. Your team would be learning from scratch." },
        Decisions: { title: "Everything would bottleneck", desc: "Without your approval, work piles up. Team members either freeze (waiting for you) or guess wrong. Both cost money and trust." },
        Relationships: { title: "Key accounts would feel abandoned", desc: "Your best customers have a relationship with YOU, not your company. If you disappear, so does their loyalty. Competitors would circle." },
        Financial: { title: "Business value would plummet", desc: "Without documented processes, no buyer or lender would touch this business. Your life's work has no transferable value." },
        Suppliers: { title: "Supply chain disruptions would spiral", desc: "Without your supplier relationships and negotiation skills, the team can't handle price changes or shortages effectively." },
        Technology: { title: "System issues would become crises", desc: "Nobody else understands how the systems connect. A routine IT issue becomes a multi-day outage." },
        Team: { title: "No one could lead", desc: "Without a clear #2, the team lacks direction. Politics emerge. Your best people start updating their resumes." },
        Growth: { title: "Growth would flatline immediately", desc: "You are the growth engine. Without you, the business can only maintain, not grow. Over time, maintaining becomes shrinking." }
    };

    scenariosList.innerHTML = highRisks.map(a => {
        const s = scenarioTexts[a.category];
        return s ? `<div class="scenario-item"><h4>⚠️ ${s.title}</h4><p>${s.desc}</p></div>` : '';
    }).join('');

    if (highRisks.length === 0) {
        scenariosList.innerHTML = '<div class="scenario-item"><h4>✅ Low Risk Profile</h4><p>Your business is well-positioned to operate independently. Focus on continuous improvement and succession planning.</p></div>';
    }

    window.depData = { totalScore, answers, cats, highRisks, verdict, scoreColor };
}

function handleDownload(e) {
    e.preventDefault();
    const firstName = document.getElementById('userFirst').value.trim();
    const lastName = document.getElementById('userLast').value.trim();
    const email = document.getElementById('userEmail').value.trim();
    if(!firstName||!lastName||!email) return;
    fetch('https://script.google.com/macros/s/AKfycbxH-0F_yuJve8Bvzf1WWqYc5Z0ptXRRktVCmLEEa-7Dbs3ear7cNESr6-Bmm8mQIJaZ/exec',{method:'POST',headers:{'Content-Type':'text/plain'},body:JSON.stringify({name:firstName+' '+lastName,email:email,tool:'Business Dependency Score',_subject:'New Lead: '+firstName+' '+lastName+' - Business Dependency Score',message:firstName+' '+lastName+' ('+email+') completed the Business Dependency Score and downloaded their PDF report.'})}).catch(function(){});
    const leads = JSON.parse(localStorage.getItem('dependency_leads') || '[]');
    leads.push({ email, timestamp: new Date().toISOString(), score: window.depData.totalScore, answers });
    localStorage.setItem('dependency_leads', JSON.stringify(leads));
    generatePDF(email);
    document.getElementById('emailForm').style.display = 'none';
    document.getElementById('downloadComplete').classList.add('active');
}

function generatePDF(email) {
    const d = window.depData;
    const doc = new jsPDF();
    const pw = doc.internal.pageSize.getWidth();
    const ph = doc.internal.pageSize.getHeight();
    const m = 15, cw = pw - 2*m;
    let y = 20;

    // Dark mode design system
    const C = {
        bg: [15, 15, 20],
        card: [25, 25, 35],
        cell: [35, 35, 45],
        border: [50, 50, 65],
        text: [241, 245, 249],
        textMid: [148, 163, 184],
        textLight: [100, 116, 139],
        white: [255, 255, 255],
        shadow: [10, 10, 15],
        blue: [96, 165, 250],
        red: [248, 113, 113],
        yellow: [251, 191, 36],
        green: [74, 222, 128],
        purple: [192, 132, 252],
        amber: [251, 191, 36]
    };

    const txt = (sz, st='normal', c=C.text) => { doc.setFontSize(sz); doc.setFont('helvetica',st); doc.setTextColor(...c); };
    const fill = (c) => doc.setFillColor(...c);
    const stroke = (c) => doc.setDrawColor(...c);

    const newPage = () => {
        doc.addPage();
        fill(C.bg); doc.rect(0,0,pw,ph,'F');
        fill(C.blue); doc.rect(0,0,pw,1.5,'F');
        y = 20;
    };

    // Simple card drawing
    const card = (x, yc, w, h, opts={}) => {
        const r = opts.radius || 3;
        fill(C.card); doc.roundedRect(x, yc, w, h, r, r, 'F');
        stroke(C.border); doc.setLineWidth(0.3);
        doc.roundedRect(x, yc, w, h, r, r, 'S');
        if(opts.accent) {
            fill(opts.accent);
            doc.roundedRect(x, yc, 3, h, r, 0, 'F');
        }
    };

    // Get wrapped lines
    const wrap = (text, fontSize, maxWidth) => {
        doc.setFontSize(fontSize);
        return doc.splitTextToSize(text, maxWidth);
    };

    // Line heights (in mm; jsPDF fontSize is in pt, ~0.35mm per pt)
    const lh = (fontSize) => fontSize * 0.65;
    const lhBody = (fontSize) => fontSize * 0.6;

    // Check page break - only if content actually won't fit
    const ensureFit = (neededHeight) => {
        if (y + neededHeight > 260) { newPage(); }
    };

    // Measure a content block's height
    const measureBlock = (items, w) => {
        let h = 20; // 10 top + 10 bottom padding
        items.forEach(item => {
            if (item.type === 'space') { h += item.h; return; }
            const fs = item.fontSize || 8;
            const mw = item.maxWidth || w - 20;
            if (item.type === 'metric') {
                h += fs * 0.65 + 4;
            } else if (item.type === 'bullet') {
                const lines = wrap(item.text, fs, mw);
                h += lines.length * lhBody(fs) + 3;
            } else {
                const lines = wrap(item.text, fs, mw);
                const lineH = item.type === 'title' ? lh(fs) : lhBody(fs);
                h += lines.length * lineH + 3;
            }
        });
        return h;
    };

    // Render a card with content items
    const renderCard = (x, w, items, opts={}) => {
        const cardH = measureBlock(items, w);
        ensureFit(cardH);
        card(x, y, w, cardH, opts);

        let cy = y + 10; // 10px top padding
        items.forEach(item => {
            if (item.type === 'space') { cy += item.h; return; }
            const fs = item.fontSize || 8;
            const mw = item.maxWidth || w - 20;
            const col = item.color || C.text;
            const style = item.style || (item.type === 'title' ? 'bold' : 'normal');

            if (item.type === 'metric') {
                txt(fs, item.style || 'bold', col);
                if (item.align === 'center') {
                    doc.text(item.text, x + w/2, cy + fs * 0.4, {align:'center'});
                } else {
                    doc.text(item.text, x + 10, cy + fs * 0.4);
                }
                cy += fs * 0.65 + 4;
            } else if (item.type === 'bullet') {
                fill(item.bulletColor || C.blue);
                doc.circle(x + 12, cy + 2.5, 1, 'F');
                txt(fs, style, col);
                const lines = wrap(item.text, fs, mw);
                lines.forEach(line => {
                    doc.text(line, x + 16, cy + fs * 0.4);
                    cy += lhBody(fs);
                });
                cy += 3;
            } else {
                // title or text
                txt(fs, style, col);
                const lines = wrap(item.text, fs, mw);
                const lineH = item.type === 'title' ? lh(fs) : lhBody(fs);
                if (item.align === 'center') {
                    lines.forEach(line => {
                        doc.text(line, x + w/2, cy + fs * 0.4, {align:'center'});
                        cy += lineH;
                    });
                } else {
                    lines.forEach(line => {
                        doc.text(line, x + 10, cy + fs * 0.4);
                        cy += lineH;
                    });
                }
                cy += 3;
            }
        });

        y += cardH + 8;
        return cardH;
    };

    // Render card at specific position (doesn't advance y)
    const renderCardAt = (x, yPos, w, items, opts={}) => {
        const cardH = measureBlock(items, w);
        card(x, yPos, w, cardH, opts);

        let cy = yPos + 10;
        items.forEach(item => {
            if (item.type === 'space') { cy += item.h; return; }
            const fs = item.fontSize || 8;
            const mw = item.maxWidth || w - 20;
            const col = item.color || C.text;
            const style = item.style || (item.type === 'title' ? 'bold' : 'normal');

            if (item.type === 'metric') {
                txt(fs, item.style || 'bold', col);
                if (item.align === 'center') doc.text(item.text, x + w/2, cy + fs * 0.4, {align:'center'});
                else doc.text(item.text, x + 10, cy + fs * 0.4);
                cy += fs * 0.65 + 4;
            } else if (item.type === 'bullet') {
                fill(item.bulletColor || C.blue);
                doc.circle(x + 12, cy + 2.5, 1, 'F');
                txt(fs, style, col);
                wrap(item.text, fs, mw).forEach(line => {
                    doc.text(line, x + 16, cy + fs * 0.4);
                    cy += lhBody(fs);
                });
                cy += 3;
            } else {
                txt(fs, style, col);
                const lines = wrap(item.text, fs, mw);
                const lineH = item.type === 'title' ? lh(fs) : lhBody(fs);
                if (item.align === 'center') {
                    lines.forEach(line => { doc.text(line, x + w/2, cy + fs * 0.4, {align:'center'}); cy += lineH; });
                } else {
                    lines.forEach(line => { doc.text(line, x + 10, cy + fs * 0.4); cy += lineH; });
                }
                cy += 3;
            }
        });
        return cardH;
    };

    const secTitle = (title, color = C.blue) => {
        ensureFit(15);
        txt(11, 'bold', C.text);
        doc.text(title, m, y + 7);
        fill(color);
        doc.rect(m, y + 10, 20, 1.5, 'F');
        y += 18;
    };

    // =============================
    // PAGE 1: COVER
    // =============================
    fill(C.bg); doc.rect(0,0,pw,ph,'F');
    fill(C.card); stroke(C.border); doc.setLineWidth(0.3);
    doc.roundedRect(0,-5,pw,70,0,0,'FD');
    fill(C.blue); doc.circle(pw/2,18,6,'F');
    txt(10,'bold',C.white); doc.text('B',pw/2,21,{align:'center'});

    txt(17,'bold',C.text); doc.text('BUSINESS DEPENDENCY REPORT',pw/2,38,{align:'center'});
    txt(9,'normal',C.textMid);
    doc.text('What If You Left Tomorrow?',pw/2,46,{align:'center'});

    fill(C.cell); doc.roundedRect(pw/2-40,54,80,8,4,4,'F');
    txt(7,'bold',C.textMid);
    doc.text(new Date().toLocaleDateString('en-US',{month:'long',day:'numeric',year:'numeric'}),pw/2,59,{align:'center'});

    y = 75;

    // Table of Contents
    renderCard(m, cw, [
        { type: 'title', text: "WHAT'S IN THIS REPORT:", fontSize: 8, color: C.blue },
        { type: 'space', h: 4 },
        { type: 'bullet', text: 'Page 1: Owner Dependency Index and Risk Assessment', fontSize: 7.5, bulletColor: C.blue },
        { type: 'bullet', text: 'Pages 2-3: Actionable Independence Roadmap by Category', fontSize: 7.5, bulletColor: C.blue },
        { type: 'bullet', text: 'Page 4: Industry Benchmarks with Sourced Metrics (2024-2025)', fontSize: 7.5, bulletColor: C.blue },
        { type: 'bullet', text: 'Pages 5-6: 90-Day Independence Roadmap (4 Phases)', fontSize: 7.5, bulletColor: C.blue },
        { type: 'bullet', text: 'Page 7: Valuation Impact Analysis', fontSize: 7.5, bulletColor: C.blue }
    ], {accent: C.blue});

    // Score visualization
    const scoreCol = d.totalScore >= 80 ? C.red : d.totalScore >= 50 ? C.amber : C.green;
    renderCard(m, cw, [
        { type: 'title', text: 'OWNER DEPENDENCY INDEX', fontSize: 9, color: scoreCol, align: 'center' },
        { type: 'space', h: 6 },
        { type: 'metric', text: d.totalScore.toString(), fontSize: 20, color: scoreCol, align: 'center' },
        { type: 'space', h: 4 },
        { type: 'text', text: d.verdict, fontSize: 8, color: C.textMid, align: 'center', maxWidth: cw-30 }
    ], {accent: scoreCol});

    // Risk summary - 3 metric cards side by side
    const critical = d.answers.filter(a=>a.score>=8).length;
    const atRisk = d.answers.filter(a=>a.score>=4&&a.score<8).length;
    const healthy = d.answers.filter(a=>a.score<4).length;
    const metW = (cw-10)/3;

    const metricItems = [
        {val:critical,label:'CRITICAL',color:C.red},
        {val:atRisk,label:'AT RISK',color:C.amber},
        {val:healthy,label:'HEALTHY',color:C.green}
    ];
    const metricContent = [{type:'metric',text:'0',fontSize:16,color:C.red,align:'center'},{type:'space',h:2},{type:'text',text:'SAMPLE',fontSize:6,style:'bold',color:C.text,align:'center'}];
    const metricH = measureBlock(metricContent, metW);
    ensureFit(metricH);

    metricItems.forEach((mt,i) => {
        const x = m + i*(metW+5);
        renderCardAt(x, y, metW, [
            { type: 'metric', text: mt.val.toString(), fontSize: 16, color: mt.color, align: 'center' },
            { type: 'space', h: 2 },
            { type: 'text', text: mt.label + ' AREAS', fontSize: 6, style: 'bold', color: C.text, align: 'center' }
        ], {accent: mt.color});
    });
    y += metricH + 8;

    // Risk assessment breakdown
    secTitle('RISK ASSESSMENT BY AREA');

    d.answers.sort((a,b)=>b.score-a.score).forEach(a => {
        const rColor = a.score>=8 ? C.red : a.score>=4 ? C.amber : C.green;
        const level = a.score>=8 ? 'CRITICAL' : a.score>=4 ? 'AT RISK' : 'HEALTHY';
        const rowH = 14;
        ensureFit(rowH);

        card(m, y, cw, rowH, {accent: rColor});
        txt(8, 'bold', C.text);
        doc.text(a.category.toUpperCase(), m + 10, y + 8.5);

        // Progress bar
        const barX = m + cw - 95, barW = 55;
        fill(C.cell); doc.roundedRect(barX, y + 5, barW, 3.5, 1.5, 1.5, 'F');
        fill(rColor); doc.roundedRect(barX, y + 5, (a.score/10)*barW, 3.5, 1.5, 1.5, 'F');

        txt(7, 'bold', rColor);
        doc.text(level, pw-m-5, y + 9, {align:'right'});

        y += rowH + 4;
    });

    // =============================
    // INDEPENDENCE ROADMAP
    // =============================
    newPage();
    secTitle('INDEPENDENCE ROADMAP');

    const roadmap = {
        Operations: {title:"Systematize Order Flow and Fulfillment",steps:[
            "Week 1: Shadow yourself for 5 days. Every time you touch an order, log it: customer name, what you did, why only you could do it. Be honest. You will find that 60-70% of your interventions follow a pattern someone else could learn. The other 30% are genuine exceptions; those get documented in Week 3.",
            "Week 2: Pick your top 5 accounts by revenue. Write a one-page 'account brief' for each: special handling rules (e.g., 'ABC Electric requires packing slips inside every box, not on the outside'), shipping preferences, common issues, and emergency contacts. This alone makes your team capable of handling 80% of daily order flow without calling you.",
            "Week 3: Set a dollar threshold (e.g., orders under $5,000) where your team can approve and ship without you. For orders above the threshold, create a one-page approval checklist: margin check, credit check, inventory check. If all three pass, ship it. Distributors with tiered approval systems reduce order cycle time by 30-40% because orders stop sitting in one person's inbox.",
            "Week 4: Build a simple dashboard (even a shared spreadsheet) showing open orders, exceptions, and daily ship rate. Review it once at end of day instead of checking orders all day. Your goal: go from touching every order to reviewing a summary. Within 30 days, you should touch fewer than 10% of orders personally."
        ]},
        Pricing: {title:"Extract and Codify Pricing Knowledge",steps:[
            "Week 1: Export your top 50 customers from your ERP or invoicing system. For each, document: standard discount %, volume breaks, any special arrangements, and who negotiated them. This is the single most valuable document in your business. If you got hit by a bus tomorrow, your team would either overprice (losing deals) or underprice (losing margin) on every one of these accounts.",
            "Week 2: Build a pricing decision matrix. Three columns: customer tier (A/B/C by volume), product category, and approved discount range. If a request falls within the range, your team approves it. Outside the range, it escalates to you. Acquirers apply a 15-20%+ valuation discount when pricing knowledge lives in the owner's head, because they cannot trust margins will hold after the sale. (MarshBerry, 2024)",
            "Week 3: Train your sales team on the matrix. Role-play the 5 most common pricing scenarios: volume discount request, competitor price match, new customer quote, annual contract renewal, and rush order surcharge. Record the role-plays so new hires can learn from them later.",
            "Week 4: Enter pricing rules into your ERP or quoting system so the software enforces your logic automatically. Set floor prices and ceiling discounts. This turns tribal knowledge into a transferable asset and prevents margin erosion when you are not reviewing every quote."
        ]},
        Knowledge: {title:"Capture and Transfer Institutional Knowledge",steps:[
            "Week 1: Record yourself doing the 10 tasks only you handle. Use Loom or any screen recorder. Five-minute videos beat 20-page documents every time. Focus on supplier portals, workaround processes, and exception handling. Example: 'When Grainger's portal rejects a PO, here is the workaround I use.' That one video could save your team 4 hours of confusion.",
            "Week 2: Create an 'Emergency Runbook': a single document covering what to do if you are unreachable for 30 days. Include: bank contacts, insurance info, key supplier reps (with direct numbers), IT vendor access, and payroll instructions. Only 46% of business owners even have a succession plan in progress; 30% have nothing at all. (PLANADVISER, 2025; Gallup, 2024)",
            "Week 3: Build a company wiki or shared drive with folders for each department. Start with the top 5 processes per department. Each SOP should answer: What triggers this? Who does it? What are the steps? What does 'done' look like? When expertise walks out the door without documentation, replacement costs reach 200% of that person's salary for leadership roles. (Gallup, 2024)",
            "Week 4: Hold a 30-minute weekly 'knowledge transfer' session where you walk one team member through a process they have never handled. Rotate the audience. Within 3 months, your entire team gains cross-functional awareness. This is insurance you cannot buy; it is the only way to eliminate single points of failure."
        ]},
        Decisions: {title:"Delegate Decision-Making Authority",steps:[
            "Week 1: Track every decision you make for 5 business days. Write each one down with three labels: A) Only I can make this, B) Someone could make this with a framework, C) Someone already knows how. You will typically find 60-70% are B or C.",
            "Week 2: For each 'C' decision, formally tell the responsible person: 'This is yours now. You do not need my approval.' Send it in writing. This feels uncomfortable, but these are decisions they already know how to make; you are just removing an unnecessary bottleneck.",
            "Week 3: For each 'B' decision, write a one-paragraph decision framework. Example: 'Customer requests a return on an order over 30 days old. If the item is undamaged and resellable, approve it. If damaged, offer 50% credit. If over $2,000, call me.' These frameworks turn your judgment into reusable guidelines.",
            "Every Friday at 4pm: Review which decisions you made that week that someone else could have made. Write the decision framework for the top one. Takes 20 minutes. After 12 weeks, you will have frameworks covering 90% of recurring decisions."
        ]},
        Relationships: {title:"Multi-Thread Customer Relationships",steps:[
            "Week 1: List your top 10 customers by revenue. For each, answer honestly: if you disappeared, would they stay? If the answer is 'probably not' for more than 3, your business has a serious key-person risk. Acquirers discount business value by 15-20%+ when customer relationships are tied to the owner personally. (MarshBerry, 2024)",
            "Week 2: For each at-risk account, identify the team member who should own the relationship. Introduce them by email: 'I want you to meet [Name], who will be your day-to-day contact for orders and service. I am still here for strategic conversations.' Frame it as better service, not abandonment. Your top 3 customers call YOUR cell phone right now. Here is how to transition them in 60 days without losing the relationship.",
            "Week 3: Have your new account contacts schedule joint visits or calls with each customer. You attend but let your team lead the conversation. The customer builds trust with the new person while you are still present as a safety net. Do not skip this step; cold handoffs lose accounts, warm handoffs keep them.",
            "Day 60 target: Your top 10 customers should each have at least two people at your company they trust. 70% of small businesses fail to sell at all (Exit Planning Institute, 2024). One of the top reasons: customer relationships that cannot transfer. Multi-threaded relationships are one of the highest-value assets in any acquisition."
        ]},
        Financial: {title:"Build Documented, Transferable Systems",steps:[
            "Week 1: Pull your last 12 months of P&L statements and create a one-page financial summary a stranger could understand. Include: revenue trends, gross margin by product line, top 10 customer concentration, and major expense categories. If your top 3 customers represent more than 40% of revenue, that is a concentration risk buyers will flag immediately.",
            "Week 2: Document your cash flow cycle: when customers pay, when you pay suppliers, and where the gaps are. Wholesalers with $1-3M EBITDA and documented systems average 7.7x EBITDA multiples. Without documentation, small businesses trade at 2-3x earnings. (First Page Sage, Q1 2025; BizBuySell, 2025)",
            "Week 3: Create a 'business manual' that covers: legal structure, insurance policies, lease terms, key contracts, and vendor agreements. This is the document a buyer, lender, or successor would need on day one. 70% of small businesses never find a buyer; lack of documentation is a leading reason. (Exit Planning Institute, 2024)",
            "Week 4: Have your accountant or bookkeeper review the manual for completeness. A clean, documented business with transferable processes commands multiples 2-4x higher than one that runs on tribal knowledge. On $1M EBITDA, that is the difference between a $2.5M and an $8M+ sale price."
        ]},
        Suppliers: {title:"Systematize Supplier Management",steps:[
            "Week 1: List your top 10 suppliers. For each, document: primary contact name and number, your account terms, volume commitments, backup suppliers, and any verbal agreements. If this information only exists in your head, your team is flying blind when you are unavailable.",
            "Week 2: Introduce your operations lead or purchasing manager to each key supplier rep. A simple email: 'Please add [Name] as an authorized contact on our account.' This takes 10 minutes per supplier and eliminates a massive single point of failure.",
            "Week 3: Create a supplier disruption playbook: if Supplier A cannot deliver, here is Supplier B. If prices increase more than 5%, here is the escalation process. If lead times double, here is how we communicate to customers. Document three scenarios per top supplier.",
            "Week 4: Set up quarterly supplier reviews where your team (not just you) evaluates performance, negotiates terms, and identifies risks. This builds organizational capability that survives your absence."
        ]},
        Technology: {title:"Reduce IT Single Points of Failure",steps:[
            "Week 1: Create a master systems document listing every tool your business uses: ERP, email, accounting, CRM, e-commerce, shipping. For each, document: admin login (stored in a password manager), vendor support contact, and who internally knows the system best.",
            "Week 2: Identify your 'bus factor' systems: tools where only you know how things connect. For each, record a 5-minute video walking through the setup, integrations, and common troubleshooting steps.",
            "Week 3: Establish a relationship with an IT support vendor or MSP who can handle emergencies. Give them documentation of your environment. The cost is typically $500-1,500/month, which is trivial compared to the cost of a multi-day outage.",
            "Week 4: Run a 'fire drill': pretend your main system is down and have your team follow the documented recovery steps without your help. Fix any gaps in the documentation based on what they struggled with."
        ]},
        Team: {title:"Develop Your Second-in-Command",steps:[
            "Week 1: Identify your strongest candidate for a #2 role. This is not necessarily your longest-tenured employee; it is the person who already makes good decisions, earns respect from peers, and understands the business holistically.",
            "Week 2: Have an honest conversation: 'I want to develop you into someone who can run this business if I am not here. Here is what that looks like.' Define three areas where they will start taking ownership this month.",
            "Week 3: Start delegating one 'owner-level' responsibility per week: running a team meeting, approving a purchase order, handling a customer escalation. Debrief afterward: what went well, what would you do differently?",
            "Day 60 target: Your #2 should be able to run the business for 2 weeks without calling you. Replacing a leader costs 200% of their salary (Gallup, 2024). But a trained #2 is not a cost; they are a multiplier. Businesses with a capable second-in-command sell for significantly higher multiples because buyers see continuity, not a single point of failure."
        ]},
        Growth: {title:"Build Growth Systems Beyond Yourself",steps:[
            "Week 1: Audit where your new business comes from. If more than 50% of new revenue depends on your personal relationships or sales efforts, you are the growth bottleneck. Document your sales process step by step.",
            "Week 2: Create a lead generation system that does not require you: referral programs, inbound marketing, trade show follow-up processes, or outbound prospecting scripts your team can execute.",
            "Week 3: Set up a weekly pipeline review where your sales team presents opportunities and you coach rather than close. Your role shifts from 'doer' to 'multiplier.' Distribution businesses with systematized sales processes command 6.4x-13x EBITDA vs. 2-3x for owner-driven operations. (First Page Sage, Q1 2025)",
            "Week 4: Define 3 growth targets that do not require your direct involvement. Track them monthly. If the business can grow 15-20% without you driving every deal, you have built something a buyer will pay a premium for."
        ]}
    };

    d.answers.filter(a=>a.score>=4).slice(0,5).forEach((a,idx) => {
        const plan = roadmap[a.category] || {title:a.category, steps:["Document current process step by step using screen recordings.","Identify and train the team member best suited to own this area.","Create a decision framework so they can handle 80% of cases without you.","Monitor outcomes weekly for 30 days, then shift to monthly reviews." ]};

        const items = [
            { type: 'title', text: `${idx+1}. ${plan.title.toUpperCase()}`, fontSize: 9, color: C.blue },
            { type: 'space', h: 4 }
        ];
        plan.steps.slice(0,3).forEach(s => {
            items.push({ type: 'bullet', text: s, fontSize: 7.5, bulletColor: C.blue, maxWidth: cw-30 });
        });
        renderCard(m, cw, items, {accent: C.blue});
    });

    // =============================
    // INDUSTRY BENCHMARKS
    // =============================
    newPage();
    secTitle('INDUSTRY BENCHMARKS: OWNER DEPENDENCY');

    const benchmarks = [
        { metric: '15-20%+', label: 'Key Person Valuation Discount', desc: 'Buyers discount business value by 15%, 20%, or more when critical operations depend on the owner. For firms where the owner IS the business, the discount can exceed 25%. Acquirers model this as a direct risk premium. (MarshBerry, 2024; Fiveable Business Valuation, 2025)', color: C.red },
        { metric: '6.4x-13x', label: 'Distribution EBITDA Multiples (Q1 2025)', desc: 'Private distribution companies sell for 6.4x (small industrial) to 13x (large wholesalers) EBITDA. Wholesalers with $5-10M EBITDA average 13x. Even small distributors ($1-3M EBITDA) command 6.4x to 7.7x when systematized. (First Page Sage, Q1 2025)', color: C.green },
        { metric: '70%', label: 'Small Businesses Fail to Sell', desc: 'Only 30% of small businesses successfully find a buyer. The remaining 70% close or dissolve without a transaction, often because the business cannot operate without the owner. (Exit Planning Institute, 2024; Teamshares, 2025)', color: C.red },
        { metric: '30%', label: 'No Succession Plan At All', desc: 'Only 46% of business owners have a formal succession plan in progress. 30% have no plan whatsoever. Meanwhile, 52% of U.S. employer businesses are owned by people aged 55+, meaning millions of businesses face leadership transitions within a decade. (PLANADVISER, 2025; Gallup, 2024)', color: C.amber },
        { metric: '200%', label: 'Cost to Replace a Key Leader', desc: 'Replacing a leader or manager costs approximately 200% of their annual salary. For technical professionals, 80%. For frontline workers, 40%. When the "key person" is the owner, replacement cost is incalculable because the knowledge often walks out the door permanently. (Gallup, 2024)', color: C.amber },
        { metric: '30 Days', label: 'The Buyer Stress Test', desc: 'During due diligence, buyers simulate your 30-day absence. They ask: who sells, who approves discounts, who manages delivery, who keeps key customers happy? If the answer is "the owner" for more than two of those, expect a discounted offer, an earn-out structure, or no offer at all. (MarshBerry, 2024)', color: C.blue }
    ];

    benchmarks.forEach(b => {
        renderCard(m, cw, [
            { type: 'metric', text: b.metric, fontSize: 14, color: b.color, align: 'center' },
            { type: 'space', h: 2 },
            { type: 'title', text: b.label, fontSize: 9, color: C.text, align: 'center' },
            { type: 'space', h: 2 },
            { type: 'text', text: b.desc, fontSize: 7.5, color: C.textMid, maxWidth: cw-30 }
        ], {accent: b.color});
    });

    // =============================
    // 90-DAY INDEPENDENCE ROADMAP
    // =============================
    newPage();
    secTitle('YOUR 90-DAY INDEPENDENCE ROADMAP');

    renderCard(m, cw, [
        { type: 'text', text: 'This roadmap sequences your independence steps logically: audit first, then document, then delegate, then verify. Each phase has clear deliverables and a target improvement to your dependency score. The goal is not perfection; it is progress. Every task you remove from your plate is a chain you break.', fontSize: 8, color: C.textMid, maxWidth: cw-20 }
    ], {accent: C.blue});

    // Phase 1
    renderCard(m, cw, [
        { type: 'title', text: 'PHASE 1: AUDIT (DAYS 1-14)', fontSize: 10, color: C.red },
        { type: 'text', text: 'Goal: See clearly where you are trapped. Target: Identify every single point of failure.', fontSize: 8, style: 'bold', color: C.textMid },
        { type: 'space', h: 4 },
        { type: 'bullet', text: 'Days 1-5: Track every decision, task, and interaction you handle personally. Use a simple notebook or spreadsheet. Columns: Time, Task, Could Someone Else Do This (Y/N), Why Not? You will fill 3-5 pages per day.', fontSize: 7.5, bulletColor: C.red, maxWidth: cw-30 },
        { type: 'bullet', text: 'Days 6-7: Categorize your list into the 6 dependency areas: Operations, Pricing, Knowledge, Decisions, Relationships, and Growth. Count how many tasks fall in each. The largest category is your biggest vulnerability.', fontSize: 7.5, bulletColor: C.red, maxWidth: cw-30 },
        { type: 'bullet', text: 'Days 8-10: For each category, identify the "bus factor": how many people can do this if you are gone? If the answer is zero, mark it red. If one person, mark it yellow. Two or more, green. Your goal by Day 90: no red items remain. Remember: replacing a key leader costs 200% of their salary (Gallup, 2024). For an owner, the cost is the entire business.', fontSize: 7.5, bulletColor: C.red, maxWidth: cw-30 },
        { type: 'bullet', text: 'Days 11-14: Rank your red items by business impact (revenue at risk). The top 5 become your documentation priorities for Phase 2. Share your audit findings with your leadership team or key employees.', fontSize: 7.5, bulletColor: C.red, maxWidth: cw-30 },
        { type: 'space', h: 4 },
        { type: 'text', text: 'Deliverables: Complete dependency audit, risk-ranked task list, bus factor map for all critical functions.', fontSize: 7.5, style: 'bold', color: C.text },
        { type: 'text', text: 'Expected score improvement: 0 points (this phase is measurement, not action).', fontSize: 7.5, color: C.textMid }
    ], {accent: C.red});

    // Phase 2
    renderCard(m, cw, [
        { type: 'title', text: 'PHASE 2: DOCUMENT (DAYS 15-30)', fontSize: 10, color: C.amber },
        { type: 'text', text: 'Goal: Get critical knowledge out of your head and into systems. Target: 15-20 point score reduction.', fontSize: 8, style: 'bold', color: C.textMid },
        { type: 'space', h: 4 },
        { type: 'bullet', text: 'Days 15-17: Start with your #1 red item. Record a 5-10 minute video of yourself doing the task. Narrate your thinking: "I check this first because... I use this shortcut because..." Video captures nuance that written SOPs miss.', fontSize: 7.5, bulletColor: C.amber, maxWidth: cw-30 },
        { type: 'bullet', text: 'Days 18-21: Document your pricing arrangements. Export your top 50 customers, write their special terms, and build the pricing decision matrix. This single document can be worth $100K+ in preserved margin during a transition.', fontSize: 7.5, bulletColor: C.amber, maxWidth: cw-30 },
        { type: 'bullet', text: 'Days 22-25: Create your Emergency Runbook: the one document someone needs if you are unreachable for 30 days. Bank contacts, insurance, key suppliers, IT access, payroll, and the top 10 customer account briefs.', fontSize: 7.5, bulletColor: C.amber, maxWidth: cw-30 },
        { type: 'bullet', text: 'Days 26-30: Write decision frameworks for your top 10 recurring decisions. Format: "If [situation], then [action]. If [exception], escalate to [person]." Each framework takes 10-15 minutes to write and saves hours of bottleneck time.', fontSize: 7.5, bulletColor: C.amber, maxWidth: cw-30 },
        { type: 'space', h: 4 },
        { type: 'text', text: 'Deliverables: 5+ process videos, pricing matrix, Emergency Runbook, 10 decision frameworks.', fontSize: 7.5, style: 'bold', color: C.text },
        { type: 'text', text: 'Common roadblock: "It is faster to just do it myself." It is, today. But every task you keep is a chain. The goal is not efficiency this week; it is freedom next year. 70% of small businesses never sell because they cannot operate without the owner. (Exit Planning Institute, 2024)', fontSize: 7.5, style: 'italic', color: C.textMid }
    ], {accent: C.amber});

    // Phase 3
    renderCard(m, cw, [
        { type: 'title', text: 'PHASE 3: DELEGATE (DAYS 31-60)', fontSize: 10, color: C.blue },
        { type: 'text', text: 'Goal: Transfer ownership of tasks and decisions to your team. Target: 20-30 point score reduction.', fontSize: 8, style: 'bold', color: C.textMid },
        { type: 'space', h: 4 },
        { type: 'bullet', text: 'Days 31-35: Start with the "C" decisions from your audit (things people already know how to do). Tell each person in writing: "This is yours now. You do not need my approval." This is the easiest win and builds momentum.', fontSize: 7.5, bulletColor: C.blue, maxWidth: cw-30 },
        { type: 'bullet', text: 'Days 36-42: Hand off your top 3 customer relationships. Introduce account contacts by email, then schedule joint calls where your team member leads and you observe. Frame it as better service: "You now have a dedicated contact who is available every day."', fontSize: 7.5, bulletColor: C.blue, maxWidth: cw-30 },
        { type: 'bullet', text: 'Days 43-50: Delegate order approval below your threshold. Let your team run daily operations using the SOPs and decision frameworks you created. Check the dashboard once at end of day instead of monitoring all day.', fontSize: 7.5, bulletColor: C.blue, maxWidth: cw-30 },
        { type: 'bullet', text: 'Days 51-60: Begin developing your #2. Assign them one owner-level responsibility per week: running a team meeting, handling a supplier negotiation, resolving a customer escalation. Debrief each one together.', fontSize: 7.5, bulletColor: C.blue, maxWidth: cw-30 },
        { type: 'space', h: 4 },
        { type: 'text', text: 'Deliverables: Formal delegation assignments in writing, customer relationship transitions started, #2 development plan in progress.', fontSize: 7.5, style: 'bold', color: C.text },
        { type: 'text', text: 'Friday ritual (20 min): Review which decisions you made this week that someone else could have made. Write the decision framework for the top one.', fontSize: 7.5, style: 'italic', color: C.textMid }
    ], {accent: C.blue});

    // Phase 4
    renderCard(m, cw, [
        { type: 'title', text: 'PHASE 4: VERIFY (DAYS 61-90)', fontSize: 10, color: C.green },
        { type: 'text', text: 'Goal: Prove the system works without you. Target: 10-15 point score reduction.', fontSize: 8, style: 'bold', color: C.textMid },
        { type: 'space', h: 4 },
        { type: 'bullet', text: 'Days 61-67: Take a 3-day "mini-vacation" from decision-making. Be available by phone for true emergencies only. Tell your team: "Handle everything you can. Call me only if something will cost us more than $5,000 or lose a customer." Track what happens.', fontSize: 7.5, bulletColor: C.green, maxWidth: cw-30 },
        { type: 'bullet', text: 'Days 68-75: Review the results. What went well? What broke? Update your SOPs and decision frameworks based on real-world gaps. This is where your documentation goes from "theoretical" to "battle-tested."', fontSize: 7.5, bulletColor: C.green, maxWidth: cw-30 },
        { type: 'bullet', text: 'Days 76-83: Run a full "fire drill" week. Do not approve any orders, make any pricing decisions, or contact any customers directly. Let the system run. Measure: revenue maintained, customer satisfaction, error rate.', fontSize: 7.5, bulletColor: C.green, maxWidth: cw-30 },
        { type: 'bullet', text: 'Days 84-90: Retake this assessment. Compare your new score to your original. If you have dropped 30+ points, your business is meaningfully more independent. If gaps remain, you know exactly where to focus next quarter.', fontSize: 7.5, bulletColor: C.green, maxWidth: cw-30 },
        { type: 'space', h: 4 },
        { type: 'text', text: 'Deliverables: 3-day absence test completed, updated SOPs, fire drill results documented, reassessment score.', fontSize: 7.5, style: 'bold', color: C.text },
        { type: 'text', text: 'The real test of a business is simple: can it run without you for 30 days and still grow? After 90 days of this roadmap, you should be able to answer "yes" for at least 2 weeks.', fontSize: 7.5, style: 'italic', color: C.textMid }
    ], {accent: C.green});

    // =============================
    // VALUATION IMPACT
    // =============================
    newPage();
    secTitle('VALUATION IMPACT: WHAT YOUR BUSINESS IS WORTH');

    renderCard(m, cw, [
        { type: 'text', text: 'Owner dependence is the single biggest valuation killer in distribution M&A. Buyers do not just pay for your current earnings; they pay for earnings they can keep after you leave. If the business depends on your relationships, decisions, or daily presence, buyers will discount the price by 15-20%+, stretch payments into earn-outs, or walk away entirely. 52% of U.S. employer businesses are owned by people aged 55+, meaning millions of transitions are coming. (MarshBerry, 2024; Gallup, 2024)', fontSize: 8, color: C.textMid, maxWidth: cw-20 }
    ], {accent: C.amber});

    // Side by side comparison
    const hw = (cw-6)/2;
    const leftItems = [
        { type: 'text', text: 'OWNER-DEPENDENT', fontSize: 6, style: 'bold', color: C.red, align: 'center' },
        { type: 'metric', text: '2-3x', fontSize: 16, color: C.red, align: 'center' },
        { type: 'text', text: 'earnings multiple', fontSize: 7, color: C.textMid, align: 'center' },
        { type: 'space', h: 2 },
        { type: 'text', text: 'Plus 15-20%+ key person discount applied during due diligence', fontSize: 6.5, color: C.red, align: 'center' }
    ];
    const rightItems = [
        { type: 'text', text: 'SYSTEMATIZED', fontSize: 6, style: 'bold', color: C.green, align: 'center' },
        { type: 'metric', text: '7-10x', fontSize: 16, color: C.green, align: 'center' },
        { type: 'text', text: 'EBITDA multiple', fontSize: 7, color: C.textMid, align: 'center' },
        { type: 'space', h: 2 },
        { type: 'text', text: 'Documented systems, trained team, transferable value', fontSize: 6.5, color: C.green, align: 'center' }
    ];
    const lH = measureBlock(leftItems, hw);
    const rH = measureBlock(rightItems, hw);
    const maxH = Math.max(lH, rH);
    ensureFit(maxH);
    renderCardAt(m, y, hw, leftItems, {accent: C.red});
    renderCardAt(m+hw+6, y, hw, rightItems, {accent: C.green});
    y += maxH + 8;

    // Concrete example
    renderCard(m, cw, [
        { type: 'title', text: 'WHAT THIS MEANS FOR A $1M EBITDA DISTRIBUTOR', fontSize: 9, color: C.text },
        { type: 'space', h: 4 },
        { type: 'bullet', text: 'Owner-dependent: $1M x 2.5x multiple = $2.5M sale price, minus 18% key person discount = $2.05M. Plus a 2-3 year earn-out where you stay on to "transition" the business. You sell your company but keep your job. And you are one of the lucky 30% who find a buyer at all. (Exit Planning Institute, 2024)', fontSize: 7.5, bulletColor: C.red, maxWidth: cw-30 },
        { type: 'bullet', text: 'Systematized: $1M x 7.7x multiple (average for small wholesalers, First Page Sage Q1 2025) = $7.7M sale price, clean close, 6-month transition. Documented processes, trained team, and multi-threaded customer relationships give the buyer confidence. You walk away with nearly 4x more money and actual freedom.', fontSize: 7.5, bulletColor: C.green, maxWidth: cw-30 },
        { type: 'space', h: 4 },
        { type: 'text', text: 'The difference: $5.65 million. That is the cost of keeping everything in your head.', fontSize: 8, style: 'bold', color: C.text }
    ], {accent: C.purple});

    // CTA
    renderCard(m, cw, [
        { type: 'title', text: "BUILD A BUSINESS THAT RUNS WITHOUT YOU", fontSize: 11, color: C.text, align: 'center' },
        { type: 'space', h: 4 },
        { type: 'text', text: "You have seen the data: owner-dependent businesses sell for 2-3x earnings. Systematized distributors sell for 6.4x-13x EBITDA (First Page Sage, Q1 2025). The difference is not luck or industry; it is documentation, delegation, and systems.", fontSize: 8, color: C.textMid, align: 'center' },
        { type: 'space', h: 4 },
        { type: 'text', text: "We help distributors build the systems and automation that create real independence, whether you want to sell in 2 years or just take a vacation without your phone buzzing every 10 minutes.", fontSize: 8, color: C.textMid, align: 'center' },
        { type: 'space', h: 6 },
        { type: 'text', text: 'mo@deeplineop.ai', fontSize: 11, style: 'bold', color: C.blue, align: 'center' }
    ]);

    // Footer on all pages
    const pc = doc.internal.getNumberOfPages();
    for(let i=1;i<=pc;i++){
        doc.setPage(i);
        fill(C.card); stroke(C.border); doc.setLineWidth(0.3);
        doc.rect(0,ph-10,pw,10,'FD');
        txt(6,'normal',C.textMid);
        doc.text('Deep Line Operations | AI Automation for Distributors',m,ph-4);
        txt(6,'normal',C.textMid);
        doc.text(`Page ${i} of ${pc}`,pw-m,ph-4,{align:'right'});
    }

    doc.save('Business-Dependency-Report.pdf');
}


init();
</script>
<!-- Navigation Menu --><div id="nav-menu" style="position:fixed;top:16px;right:16px;z-index:10000;font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,sans-serif;">
    <button id="nav-toggle" style="background:#12121a;border:1px solid #2a2a3a;color:#f1f5f9;padding:8px 14px;border-radius:8px;cursor:pointer;font-weight:600;display:flex;align-items:center;gap:8px;box-shadow:0 4px 12px rgba(0,0,0,0.5);font-size:14px;">
        <svg width="18" height="18" viewBox="0 0 18 18" fill="none"><rect y="3" width="18" height="2" rx="1" fill="#f1f5f9"/><rect y="8" width="18" height="2" rx="1" fill="#f1f5f9"/><rect y="13" width="18" height="2" rx="1" fill="#f1f5f9"/></svg>
        Tools
    </button>
    <div id="nav-content" style="display:none;position:absolute;top:48px;right:0;background:#12121a;border:1px solid #2a2a3a;border-radius:12px;width:270px;padding:8px;box-shadow:0 8px 24px rgba(0,0,0,0.7);">
        <a href="index.html" style="display:flex;align-items:center;gap:10px;padding:10px 12px;color:#f1f5f9;text-decoration:none;border-radius:6px;font-size:14px;border-left:3px solid #6366f1;background:rgba(99,102,241,0.08);margin-bottom:4px;">
            <img src="logo-icon.png" alt="" style="height:18px;width:18px;object-fit:contain;">
            <strong>All Tools</strong>
        </a>
        <div style="height:1px;background:#2a2a3a;margin:6px 4px;"></div>
        <a href="business-dependency.html" class="nav-link" data-color="#3b82f6" style="display:flex;align-items:center;gap:10px;padding:9px 12px;color:#94a3b8;text-decoration:none;border-radius:6px;font-size:13px;">
            <svg width="18" height="18" viewBox="0 0 18 18" fill="none"><path d="M9 2l6 4v6l-6 4-6-4V6l6-4z" stroke="#3b82f6" stroke-width="1.5" stroke-linejoin="round"/><circle cx="9" cy="9" r="2" fill="#3b82f6"/></svg>
            Business Dependency
        </a>
        <a href="ceo-time-audit.html" class="nav-link" data-color="#f59e0b" style="display:flex;align-items:center;gap:10px;padding:9px 12px;color:#94a3b8;text-decoration:none;border-radius:6px;font-size:13px;">
            <svg width="18" height="18" viewBox="0 0 18 18" fill="none"><rect x="2" y="3" width="14" height="12" rx="2" stroke="#f59e0b" stroke-width="1.5"/><path d="M2 7h14M6 3v-1M12 3v-1" stroke="#f59e0b" stroke-width="1.5" stroke-linecap="round"/><rect x="5" y="9" width="2" height="2" rx=".5" fill="#f59e0b"/><rect x="8" y="9" width="2" height="2" rx=".5" fill="#f59e0b"/></svg>
            CEO Time Audit
        </a>
        <a href="profit-leak-diagnostic.html" class="nav-link" data-color="#ef4444" style="display:flex;align-items:center;gap:10px;padding:9px 12px;color:#94a3b8;text-decoration:none;border-radius:6px;font-size:13px;">
            <svg width="18" height="18" viewBox="0 0 18 18" fill="none"><circle cx="9" cy="9" r="7.5" stroke="#ef4444" stroke-width="1.5"/><path d="M9 5v5l3 2" stroke="#ef4444" stroke-width="1.5" stroke-linecap="round"/><path d="M12 3l2-1M6 3L4 2" stroke="#ef4444" stroke-width="1.2" stroke-linecap="round"/></svg>
            Profit Leak Diagnostic
        </a>
        <a href="ai-readiness-scorecard.html" class="nav-link" data-color="#a855f7" style="display:flex;align-items:center;gap:10px;padding:9px 12px;color:#94a3b8;text-decoration:none;border-radius:6px;font-size:13px;">
            <svg width="18" height="18" viewBox="0 0 18 18" fill="none"><rect x="1" y="1" width="16" height="16" rx="3" stroke="#a855f7" stroke-width="1.5"/><path d="M5 12V8M9 12V5M13 12V9" stroke="#a855f7" stroke-width="2" stroke-linecap="round"/></svg>
            AI Readiness Scorecard
        </a>
        <a href="rfq-parser.html" class="nav-link" data-color="#06b6d4" style="display:flex;align-items:center;gap:10px;padding:9px 12px;color:#94a3b8;text-decoration:none;border-radius:6px;font-size:13px;">
            <svg width="18" height="18" viewBox="0 0 18 18" fill="none"><rect x="3" y="1" width="12" height="16" rx="2" stroke="#06b6d4" stroke-width="1.5"/><path d="M6 5h6M6 8h6M6 11h4" stroke="#06b6d4" stroke-width="1.2" stroke-linecap="round"/></svg>
            RFQ Parser
        </a>
        <a href="reorder-calculator.html" class="nav-link" data-color="#22c55e" style="display:flex;align-items:center;gap:10px;padding:9px 12px;color:#94a3b8;text-decoration:none;border-radius:6px;font-size:13px;">
            <svg width="18" height="18" viewBox="0 0 18 18" fill="none"><rect x="2" y="6" width="14" height="10" rx="2" stroke="#22c55e" stroke-width="1.5"/><path d="M6 6V4a3 3 0 016 0v2" stroke="#22c55e" stroke-width="1.5"/><circle cx="9" cy="11" r="1.5" fill="#22c55e"/></svg>
            Reorder Calculator
        </a>
    </div>
</div>
<script>
(function(){
    var tgl=document.getElementById('nav-toggle'),cnt=document.getElementById('nav-content');
    if(!tgl||!cnt)return;
    tgl.onclick=function(e){e.stopPropagation();var v=cnt.style.display==='block';cnt.style.display=v?'none':'block';tgl.style.background=v?'#12121a':'#1a1a25';};
    document.addEventListener('click',function(){cnt.style.display='none';tgl.style.background='#12121a';});
    cnt.onclick=function(e){e.stopPropagation();};
    var links=document.querySelectorAll('.nav-link');
    links.forEach(function(l){
        l.onmouseenter=function(){l.style.background='rgba(255,255,255,0.06)';l.style.color='#f1f5f9';};
        l.onmouseleave=function(){if(!l.classList.contains('nav-active')){l.style.background='';l.style.color='#94a3b8';}};
    });
    var cur=window.location.pathname.split('/').pop()||'index.html';
    document.querySelectorAll('#nav-content a').forEach(function(a){
        if(a.getAttribute('href')===cur||(cur===''&&a.getAttribute('href')==='index.html')){
            a.classList.add('nav-active');a.style.background='rgba(255,255,255,0.1)';a.style.color='#fff';a.style.fontWeight='600';
        }
    });
})();
</script>
</body>
</html>
