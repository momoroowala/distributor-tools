<!DOCTYPE html>
<html lang="en">
<head>
    <link rel="icon" type="image/svg+xml" href="favicon.svg">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Business Dependency Score | What If You Left Tomorrow?</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <style>
        *{margin:0;padding:0;box-sizing:border-box}
        :root{--bg-primary:#0a0a0f;--bg-secondary:#12121a;--bg-tertiary:#1a1a25;--accent:#3b82f6;--accent-hover:#60a5fa;--accent-light:rgba(59,130,246,0.1);--text-primary:#f1f5f9;--text-secondary:#94a3b8;--text-muted:#64748b;--border:#2a2a3a;--success:#22c55e;--warning:#f59e0b;--danger:#ef4444}
        body{font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,sans-serif;background:var(--bg-primary);color:var(--text-primary);min-height:100vh;line-height:1.6}
        .container{max-width:700px;margin:0 auto;padding:2rem}
        header{text-align:center;margin-bottom:2rem;padding-top:2rem}
        .badge{display:inline-block;background:var(--accent);color:white;padding:0.25rem 0.75rem;border-radius:9999px;font-size:0.75rem;font-weight:600;text-transform:uppercase;letter-spacing:0.05em;margin-bottom:1rem}
        h1{font-size:2.1rem;font-weight:700;margin-bottom:0.75rem;background:linear-gradient(135deg,var(--text-primary),var(--accent));-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text}
        .subtitle{color:var(--text-secondary);font-size:1.05rem;max-width:530px;margin:0 auto}
        .scenario-box{background:var(--bg-secondary);border:1px solid var(--danger);border-radius:1rem;padding:1.5rem;margin-bottom:2rem;text-align:center}
        .scenario-box .icon{font-size:2rem;margin-bottom:0.5rem}
        .scenario-box p{color:var(--text-secondary);font-size:0.95rem}
        .scenario-box strong{color:var(--danger)}
        .progress-container{background:var(--bg-secondary);border:1px solid var(--border);border-radius:1rem;padding:1.25rem 1.5rem;margin-bottom:1.5rem}
        .progress-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:0.5rem}
        .progress-label{font-size:0.8rem;color:var(--text-muted)}
        .progress-count{font-size:0.8rem;color:var(--accent);font-weight:600}
        .progress-bar{height:6px;background:var(--bg-tertiary);border-radius:9999px;overflow:hidden}
        .progress-fill{height:100%;background:linear-gradient(90deg,var(--accent),var(--accent-hover));border-radius:9999px;transition:width 0.3s}
        .q-card{background:var(--bg-secondary);border:1px solid var(--border);border-radius:1rem;padding:2rem;display:none}
        .q-card.active{display:block;animation:slideIn 0.3s ease}
        @keyframes slideIn{from{opacity:0;transform:translateX(20px)}to{opacity:1;transform:translateX(0)}}
        .q-category{display:inline-block;background:var(--accent-light);color:var(--accent);padding:0.2rem 0.6rem;border-radius:0.25rem;font-size:0.7rem;font-weight:600;text-transform:uppercase;letter-spacing:0.05em;margin-bottom:0.75rem}
        .q-text{font-size:1.15rem;font-weight:600;margin-bottom:1.25rem;line-height:1.35}
        .options{display:flex;flex-direction:column;gap:0.75rem}
        .option{background:var(--bg-tertiary);border:2px solid var(--border);border-radius:0.75rem;padding:1rem 1.25rem;cursor:pointer;transition:all 0.2s;display:flex;align-items:center;gap:1rem}
        .option:hover{border-color:var(--accent);background:var(--accent-light)}
        .option.selected{border-color:var(--accent);background:var(--accent-light)}
        .option-indicator{width:22px;height:22px;border:2px solid var(--border);border-radius:50%;flex-shrink:0;display:flex;align-items:center;justify-content:center;transition:all 0.2s}
        .option.selected .option-indicator{background:var(--accent);border-color:var(--accent)}
        .option.selected .option-indicator::after{content:'';width:8px;height:8px;background:white;border-radius:50%}
        .option-text{font-size:0.95rem}
        .risk-tag{font-size:0.7rem;padding:0.15rem 0.5rem;border-radius:9999px;margin-left:auto;flex-shrink:0}
        .risk-tag.high{background:rgba(239,68,68,0.2);color:var(--danger)}
        .risk-tag.medium{background:rgba(245,158,11,0.2);color:var(--warning)}
        .risk-tag.low{background:rgba(34,197,94,0.2);color:var(--success)}
        .nav-buttons{display:flex;gap:1rem;margin-top:1.5rem}
        .btn{flex:1;padding:0.875rem 1.25rem;border-radius:0.5rem;font-weight:600;font-size:0.95rem;cursor:pointer;transition:all 0.2s;border:none}
        .btn-primary{background:var(--accent);color:white}
        .btn-primary:hover{background:var(--accent-hover)}
        .btn-secondary{background:var(--bg-tertiary);color:var(--text-secondary);border:1px solid var(--border)}
        .btn-secondary:hover{background:var(--border);color:var(--text-primary)}
        .btn:disabled{opacity:0.5;cursor:not-allowed}
        /* Results */
        .results-page{display:none}
        .results-page.active{display:block;animation:fadeIn 0.4s ease}
        @keyframes fadeIn{from{opacity:0;transform:translateY(20px)}to{opacity:1;transform:translateY(0)}}
        .score-card{background:var(--bg-secondary);border:1px solid var(--border);border-radius:1rem;padding:2.5rem;text-align:center;margin-bottom:2rem}
        .gauge{width:180px;height:90px;margin:0 auto 1rem;position:relative;overflow:hidden}
        .gauge-bg{width:180px;height:90px;border-radius:90px 90px 0 0;background:conic-gradient(from 0.75turn at 50% 100%,var(--success) 0%,var(--warning) 40%,var(--danger) 80%);position:absolute;top:0}
        .gauge-needle{width:4px;height:80px;background:white;position:absolute;bottom:0;left:50%;transform-origin:bottom center;transform:translateX(-50%) rotate(-90deg);transition:transform 1s ease;border-radius:2px}
        .gauge-center{width:20px;height:20px;background:var(--bg-secondary);border-radius:50%;position:absolute;bottom:-5px;left:50%;transform:translateX(-50%);border:3px solid white}
        .score-number{font-size:3rem;font-weight:700;line-height:1}
        .score-label{font-size:0.85rem;color:var(--text-muted);margin-top:0.25rem}
        .score-verdict{font-size:1.4rem;font-weight:600;margin-top:0.75rem}
        .score-desc{color:var(--text-secondary);max-width:450px;margin:0.5rem auto 0;font-size:0.95rem}
        .risk-grid{display:grid;grid-template-columns:repeat(2,1fr);gap:1rem;margin-bottom:2rem}
        .risk-card{background:var(--bg-secondary);border:1px solid var(--border);border-radius:0.75rem;padding:1.25rem}
        .risk-card h4{font-size:0.85rem;color:var(--text-muted);margin-bottom:0.5rem;text-transform:uppercase;letter-spacing:0.05em}
        .risk-card .score{font-size:1.75rem;font-weight:700;line-height:1}
        .risk-card .detail{font-size:0.8rem;color:var(--text-secondary);margin-top:0.25rem}
        .scenarios{background:var(--bg-secondary);border:1px solid var(--border);border-radius:1rem;padding:2rem;margin-bottom:2rem}
        .scenarios h3{font-size:1.1rem;margin-bottom:1rem}
        .scenario-item{padding:1rem;background:var(--bg-tertiary);border-radius:0.75rem;margin-bottom:0.75rem}
        .scenario-item:last-child{margin-bottom:0}
        .scenario-item h4{font-size:0.95rem;margin-bottom:0.25rem}
        .scenario-item p{font-size:0.85rem;color:var(--text-secondary)}
        .download-section{background:linear-gradient(135deg,var(--accent-light),var(--bg-secondary));border:2px solid var(--accent);border-radius:1rem;padding:2.5rem;text-align:center;margin-bottom:2rem}
        .download-section h3{font-size:1.4rem;margin-bottom:0.5rem}
        .download-section>p{color:var(--text-secondary);margin-bottom:1.5rem}
        .download-features{display:flex;justify-content:center;gap:1.5rem;margin-bottom:1.5rem;flex-wrap:wrap}
        .download-feature{display:flex;align-items:center;gap:0.4rem;font-size:0.85rem;color:var(--text-secondary)}
        .download-feature .icon{color:var(--success)}
        .email-form{display:flex;gap:0.75rem;max-width:450px;margin:0 auto;flex-wrap:wrap}
        .email-form input[type="email"]{flex:1;min-width:200px;padding:0.875rem 1rem;background:var(--bg-primary);border:1px solid var(--border);border-radius:0.5rem;color:var(--text-primary);font-size:1rem}
        .email-form input:focus{outline:none;border-color:var(--accent)}
        .email-form .btn{flex:none;min-width:180px}
        .download-complete{display:none;color:var(--success);padding:1rem;font-size:1rem}
        .download-complete.active{display:block}
        footer{text-align:center;padding:2rem;color:var(--text-muted);font-size:0.875rem}
        footer a{color:var(--accent);text-decoration:none}
        @media(max-width:640px){.container{padding:1rem}h1{font-size:1.65rem}.score-number{font-size:2.25rem}.risk-grid{grid-template-columns:1fr}}
    </style>
</head>
<body>
<div class="container">
    <header>
    <link rel="icon" type="image/svg+xml" href="favicon.svg">
        <span class="badge">Free Assessment</span>
        <h1>What If You Left Tomorrow?</h1>
        <p class="subtitle">How long would your business survive without you? This 10-question assessment reveals your single points of failure.</p>
    </header>

    <div class="scenario-box">
        <div class="icon">⚠️</div>
        <p>Imagine you had a medical emergency and <strong>couldn't work for 30 days</strong>. What would happen to your business? Let's find out.</p>
    </div>

    <div class="progress-container" id="progressContainer">
        <div class="progress-header">
            <span class="progress-label">Assessment Progress</span>
            <span class="progress-count"><span id="currentQ">1</span> of <span id="totalQ">10</span></span>
        </div>
        <div class="progress-bar"><div class="progress-fill" id="progressFill" style="width:10%"></div></div>
    </div>

    <div id="questionsContainer"></div>

    <div class="results-page" id="resultsPage">
        <div class="score-card">
            <div class="gauge" id="gauge">
                <div class="gauge-bg"></div>
                <div class="gauge-needle" id="needle"></div>
                <div class="gauge-center"></div>
            </div>
            <div class="score-number" id="totalScore">0</div>
            <div class="score-label">Owner Dependency Index (out of 100)</div>
            <div class="score-verdict" id="verdict"></div>
            <div class="score-desc" id="verdictDesc"></div>
        </div>

        <div class="risk-grid" id="riskGrid"></div>

        <div class="scenarios" id="scenariosSection">
            <h3>What Would Actually Happen</h3>
            <div id="scenariosList"></div>
        </div>

        <div class="download-section">
            <h3>📄 Get Your Independence Roadmap</h3>
            <p>Download a detailed PDF with specific steps to reduce your dependency score, build a business that runs without you, and create real freedom.</p>
            <div class="download-features">
                <div class="download-feature"><span class="icon">✓</span><span>Risk-by-risk action plan</span></div>
                <div class="download-feature"><span class="icon">✓</span><span>Succession readiness checklist</span></div>
                <div class="download-feature"><span class="icon">✓</span><span>90-day freedom roadmap</span></div>
            </div>
            <form class="email-form" id="emailForm" onsubmit="handleDownload(event)" style="flex-direction:column;align-items:stretch;max-width:420px;margin:0 auto;gap:0.5rem;">
                <div style="display:flex;gap:0.5rem;width:100%;">
                    <input type="text" id="userFirst" placeholder="First name" required style="flex:1;padding:0.75rem;background:var(--bg);border:1px solid var(--border);border-radius:0.5rem;color:var(--text);font-size:0.95rem;">
                    <input type="text" id="userLast" placeholder="Last name" required style="flex:1;padding:0.75rem;background:var(--bg);border:1px solid var(--border);border-radius:0.5rem;color:var(--text);font-size:0.95rem;">
                </div>
                <input type="email" id="userEmail" placeholder="Work email" required style="width:100%;padding:0.75rem;background:var(--bg);border:1px solid var(--border);border-radius:0.5rem;color:var(--text);font-size:0.95rem;">
                <button type="submit" class="btn btn-primary">Download PDF Report</button>
            </form>
            <div class="download-complete" id="downloadComplete">✓ Report downloaded! Check your downloads folder.</div>
        </div>
    </div>
    <footer><p>Built by <a href="#">Mo Roowala</a> | AI Automation for Distributors</p></footer>
</div>
<script>
const { jsPDF } = window.jspdf;

const questions = [
    {
        category: "Operations",
        question: "If you didn't show up for a week, could orders still ship correctly?",
        options: [
            { text: "No, I approve most orders or handle key accounts personally", score: 10, risk: "high" },
            { text: "Some would, but big orders would stall", score: 6, risk: "medium" },
            { text: "Yes, my team handles day-to-day order flow", score: 2, risk: "low" }
        ]
    },
    {
        category: "Pricing",
        question: "Does anyone else know your top customers' special pricing arrangements?",
        options: [
            { text: "No, it's mostly in my head or my email", score: 10, risk: "high" },
            { text: "Some is documented, but I'm the final authority", score: 6, risk: "medium" },
            { text: "Yes, pricing rules are in our system and team knows them", score: 2, risk: "low" }
        ]
    },
    {
        category: "Knowledge",
        question: "How much critical business knowledge exists only in your head?",
        options: [
            { text: "A lot: supplier contacts, customer history, process workarounds", score: 10, risk: "high" },
            { text: "Some things, but key processes are documented", score: 5, risk: "medium" },
            { text: "Very little, we've documented everything important", score: 1, risk: "low" }
        ]
    },
    {
        category: "Decisions",
        question: "How many daily decisions require your personal approval?",
        options: [
            { text: "Most: pricing, purchasing, hiring, complaints, exceptions", score: 10, risk: "high" },
            { text: "Several key ones, team handles the routine stuff", score: 5, risk: "medium" },
            { text: "Very few, I've empowered my team with clear guidelines", score: 1, risk: "low" }
        ]
    },
    {
        category: "Relationships",
        question: "How many of your top 10 customers have a relationship with your company beyond just you?",
        options: [
            { text: "Most call me directly for everything", score: 10, risk: "high" },
            { text: "Half have other contacts, half rely on me", score: 5, risk: "medium" },
            { text: "All of them work with my team; I'm involved strategically", score: 1, risk: "low" }
        ]
    },
    {
        category: "Financial",
        question: "Could your business get a bank loan or be acquired based on documented processes and systems?",
        options: [
            { text: "Honestly, no. It runs on tribal knowledge and relationships", score: 10, risk: "high" },
            { text: "Partially. Some things are documented, but gaps exist", score: 5, risk: "medium" },
            { text: "Yes, we have SOPs, documented systems, and transferable processes", score: 1, risk: "low" }
        ]
    },
    {
        category: "Suppliers",
        question: "Could your team handle a major supplier price change or disruption without you?",
        options: [
            { text: "No, I negotiate everything and make all supplier decisions", score: 10, risk: "high" },
            { text: "For routine changes yes, but crises need me", score: 5, risk: "medium" },
            { text: "Yes, we have processes and backup plans documented", score: 1, risk: "low" }
        ]
    },
    {
        category: "Technology",
        question: "If a key system went down, who would fix it or manage the crisis?",
        options: [
            { text: "Me. I'm the only one who understands how everything connects", score: 10, risk: "high" },
            { text: "We have some IT support, but I'd need to guide them", score: 5, risk: "medium" },
            { text: "Our IT team or vendor handles it with documented procedures", score: 1, risk: "low" }
        ]
    },
    {
        category: "Team",
        question: "Is there someone who could step in as acting leader for 30 days?",
        options: [
            { text: "No one could fill my role, even temporarily", score: 10, risk: "high" },
            { text: "Someone could handle basics, but not the full scope", score: 5, risk: "medium" },
            { text: "Yes, I have a capable #2 who knows the business well", score: 1, risk: "low" }
        ]
    },
    {
        category: "Growth",
        question: "Could your business grow 20% next year if you stepped back to part-time?",
        options: [
            { text: "Impossible. I AM the growth engine", score: 10, risk: "high" },
            { text: "It would plateau, but not collapse", score: 5, risk: "medium" },
            { text: "Yes, the systems and team could drive growth without me", score: 1, risk: "low" }
        ]
    }
];

let currentQuestion = 0;
let answers = [];

function init() {
    document.getElementById('totalQ').textContent = questions.length;
    renderQuestion(0);
}

function renderQuestion(idx) {
    const q = questions[idx];
    const container = document.getElementById('questionsContainer');
    container.innerHTML = `
        <div class="q-card active">
            <span class="q-category">${q.category}</span>
            <h2 class="q-text">${q.question}</h2>
            <div class="options">
                ${q.options.map((o,i) => `
                    <div class="option" onclick="selectOption(${i})" data-idx="${i}">
                        <div class="option-indicator"></div>
                        <span class="option-text">${o.text}</span>
                        <span class="risk-tag ${o.risk}">${o.risk} risk</span>
                    </div>
                `).join('')}
            </div>
            <div class="nav-buttons">
                <button class="btn btn-secondary" onclick="prevQ()" ${idx===0?'disabled':''}>← Back</button>
                <button class="btn btn-primary" onclick="nextQ()" id="nextBtn" disabled>${idx===questions.length-1?'See My Score':'Next →'}</button>
            </div>
        </div>`;

    if (answers[idx] !== undefined) {
        document.querySelectorAll('.option')[answers[idx].optionIndex].classList.add('selected');
        document.getElementById('nextBtn').disabled = false;
    }
    document.getElementById('currentQ').textContent = idx + 1;
    document.getElementById('progressFill').style.width = ((idx+1)/questions.length*100) + '%';
}

function selectOption(optIdx) {
    document.querySelectorAll('.option').forEach(o => o.classList.remove('selected'));
    document.querySelectorAll('.option')[optIdx].classList.add('selected');
    const q = questions[currentQuestion];
    answers[currentQuestion] = {
        optionIndex: optIdx,
        score: q.options[optIdx].score,
        risk: q.options[optIdx].risk,
        category: q.category,
        question: q.question,
        answer: q.options[optIdx].text
    };
    document.getElementById('nextBtn').disabled = false;
}

function nextQ() {
    if (currentQuestion < questions.length-1) { currentQuestion++; renderQuestion(currentQuestion); }
    else showResults();
}

function prevQ() {
    if (currentQuestion > 0) { currentQuestion--; renderQuestion(currentQuestion); }
}

function showResults() {
    document.getElementById('questionsContainer').style.display = 'none';
    document.getElementById('progressContainer').style.display = 'none';
    document.querySelector('.scenario-box').style.display = 'none';
    document.getElementById('resultsPage').classList.add('active');

    const totalScore = answers.reduce((s,a) => s+a.score, 0);
    document.getElementById('totalScore').textContent = totalScore;

    // Gauge needle
    const needleAngle = -90 + (totalScore/100)*180;
    setTimeout(() => {
        document.getElementById('needle').style.transform = `translateX(-50%) rotate(${needleAngle}deg)`;
    }, 200);

    let verdict, verdictDesc, scoreColor;
    if (totalScore >= 80) {
        verdict = "Your business can't survive without you";
        verdictDesc = "You don't own a business. You own a job you can never leave. Every major function depends on you personally.";
        scoreColor = [239,68,68];
    } else if (totalScore >= 60) {
        verdict = "High dependency, major risks";
        verdictDesc = "Your business would struggle significantly within days of your absence. Several critical functions have no backup.";
        scoreColor = [245,158,11];
    } else if (totalScore >= 40) {
        verdict = "Moderate dependency, some risks";
        verdictDesc = "Your team could keep things running short-term, but growth would stop and problems would pile up.";
        scoreColor = [245,158,11];
    } else {
        verdict = "Well-built, low dependency";
        verdictDesc = "Your business has strong systems and capable people. You could step back and it would continue to operate.";
        scoreColor = [34,197,94];
    }

    const verdictEl = document.getElementById('verdict');
    verdictEl.textContent = verdict;
    verdictEl.style.color = `rgb(${scoreColor.join(',')})`;
    document.getElementById('totalScore').style.color = `rgb(${scoreColor.join(',')})`;
    document.getElementById('verdictDesc').textContent = verdictDesc;

    // Risk categories
    const cats = {};
    answers.forEach(a => {
        if (!cats[a.category]) cats[a.category] = {total:0,count:0,risks:[]};
        cats[a.category].total += a.score;
        cats[a.category].count++;
        cats[a.category].risks.push(a);
    });

    const riskGrid = document.getElementById('riskGrid');
    riskGrid.innerHTML = Object.entries(cats).map(([cat,data]) => {
        const avg = data.total / data.count;
        const color = avg >= 8 ? 'var(--danger)' : avg >= 4 ? 'var(--warning)' : 'var(--success)';
        const level = avg >= 8 ? 'Critical' : avg >= 4 ? 'At Risk' : 'Healthy';
        return `<div class="risk-card">
            <h4>${cat}</h4>
            <div class="score" style="color:${color}">${level}</div>
            <div class="detail">${data.risks[0].answer.substring(0,60)}...</div>
        </div>`;
    }).join('');

    // Scenarios
    const highRisks = answers.filter(a => a.score >= 8);
    const scenariosList = document.getElementById('scenariosList');
    
    const scenarioTexts = {
        Operations: { title: "Orders would stall or ship wrong", desc: "Without you approving and overseeing, order accuracy drops and key accounts don't get their special handling. Within a week, your biggest customers start calling." },
        Pricing: { title: "Margin would hemorrhage", desc: "Nobody knows the special pricing arrangements. Reps either overprice (losing deals) or underprice (losing margin). Either way, money walks out the door." },
        Knowledge: { title: "Institutional knowledge would be lost", desc: "All those supplier workarounds, customer preferences, and process shortcuts that only you know? Gone. Your team would be learning from scratch." },
        Decisions: { title: "Everything would bottleneck", desc: "Without your approval, work piles up. Team members either freeze (waiting for you) or guess wrong. Both cost money and trust." },
        Relationships: { title: "Key accounts would feel abandoned", desc: "Your best customers have a relationship with YOU, not your company. If you disappear, so does their loyalty. Competitors would circle." },
        Financial: { title: "Business value would plummet", desc: "Without documented processes, no buyer or lender would touch this business. Your life's work has no transferable value." },
        Suppliers: { title: "Supply chain disruptions would spiral", desc: "Without your supplier relationships and negotiation skills, the team can't handle price changes or shortages effectively." },
        Technology: { title: "System issues would become crises", desc: "Nobody else understands how the systems connect. A routine IT issue becomes a multi-day outage." },
        Team: { title: "No one could lead", desc: "Without a clear #2, the team lacks direction. Politics emerge. Your best people start updating their resumes." },
        Growth: { title: "Growth would flatline immediately", desc: "You are the growth engine. Without you, the business can only maintain, not grow. Over time, maintaining becomes shrinking." }
    };

    scenariosList.innerHTML = highRisks.map(a => {
        const s = scenarioTexts[a.category];
        return s ? `<div class="scenario-item"><h4>⚠️ ${s.title}</h4><p>${s.desc}</p></div>` : '';
    }).join('');

    if (highRisks.length === 0) {
        scenariosList.innerHTML = '<div class="scenario-item"><h4>✅ Low Risk Profile</h4><p>Your business is well-positioned to operate independently. Focus on continuous improvement and succession planning.</p></div>';
    }

    window.depData = { totalScore, answers, cats, highRisks, verdict, scoreColor };
}

function handleDownload(e) {
    e.preventDefault();
    const firstName = document.getElementById('userFirst').value.trim();
    const lastName = document.getElementById('userLast').value.trim();
    const email = document.getElementById('userEmail').value.trim();
    if(!firstName||!lastName||!email) return;
    fetch('https://script.google.com/macros/s/AKfycbxH-0F_yuJve8Bvzf1WWqYc5Z0ptXRRktVCmLEEa-7Dbs3ear7cNESr6-Bmm8mQIJaZ/exec',{method:'POST',headers:{'Content-Type':'text/plain'},body:JSON.stringify({name:firstName+' '+lastName,email:email,tool:'Business Dependency Score',_subject:'New Lead: '+firstName+' '+lastName+' - Business Dependency Score',message:firstName+' '+lastName+' ('+email+') completed the Business Dependency Score and downloaded their PDF report.'})}).catch(function(){});
    const leads = JSON.parse(localStorage.getItem('dependency_leads') || '[]');
    leads.push({ email, timestamp: new Date().toISOString(), score: window.depData.totalScore, answers });
    localStorage.setItem('dependency_leads', JSON.stringify(leads));
    generatePDF(email);
    document.getElementById('emailForm').style.display = 'none';
    document.getElementById('downloadComplete').classList.add('active');
}

function generatePDF(email) {
    const d = window.depData;
    const doc = new jsPDF();
    const pw = doc.internal.pageSize.getWidth();
    const ph = doc.internal.pageSize.getHeight();
    const m = 15, cw = pw - 2*m;
    let y = 0;

    // Design system - Material Design
    const C = {
        bg: [241, 243, 244], card: [255, 255, 255], border: [218, 220, 224],
        text: [32, 33, 36], textMid: [95, 99, 104], textLight: [128, 134, 139],
        white: [255, 255, 255], shadow: [232, 234, 237],
        blue: [26, 115, 232], red: [217, 48, 37], yellow: [249, 171, 0], 
        green: [30, 142, 62], purple: [161, 66, 244], amber: [210, 145, 30]
    };

    const txt = (t,sz,st='normal',c=C.text) => { doc.setFontSize(sz); doc.setFont('helvetica',st); doc.setTextColor(...c); };
    const fill = (c) => doc.setFillColor(...c);
    const stroke = (c) => doc.setDrawColor(...c);

    // Dynamic text fitting helper
    const fitText = (doc, text, maxWidth, startSize, minSize) => {
        let sz = startSize;
        let lines;
        while (sz >= minSize) {
            doc.setFontSize(sz);
            lines = doc.splitTextToSize(text, maxWidth);
            if (lines.length <= 3) break;
            sz -= 0.5;
        }
        return { lines, fontSize: sz };
    };

    // Calculate actual content height before drawing
    const measureContent = (content) => {
        let totalHeight = 0;
        content.forEach(item => {
            if (item.type === 'text') {
                doc.setFontSize(item.fontSize || 9);
                const lines = doc.splitTextToSize(item.text, item.maxWidth || cw - 20);
                totalHeight += lines.length * (item.lineHeight || 6);
            } else if (item.type === 'space') {
                totalHeight += item.height;
            } else if (item.type === 'circle') {
                totalHeight += item.radius * 2;
            }
        });
        return totalHeight + 8; // Add bottom padding
    };
    
    // Dynamic page break checking with actual content height
    const cp = (contentHeight) => { 
        if(y + contentHeight > 270){
            newPage(); 
            return true;
        } 
        return false; 
    };

    const newPage = () => {
        doc.addPage();
        fill(C.bg); doc.rect(0,0,pw,ph,'F');
        fill(C.blue); doc.rect(0,0,pw,1.5,'F');
        y = 15;
    };

    const dynamicCard = (x, yPos, w, content, opts = {}) => {
        // Measure content first
        const contentHeight = measureContent(content);
        const totalHeight = contentHeight + 16; // 8px top + bottom padding
        
        // Draw card background
        const r = opts.radius || 2;
        fill(C.shadow); doc.roundedRect(x+0.5, yPos+0.5, w, totalHeight, r, r, 'F');
        stroke(C.border); doc.setLineWidth(0.2);
        fill(C.card); doc.roundedRect(x, yPos, w, totalHeight, r, r, 'FD');
        if(opts.accent) { 
            fill(opts.accent); 
            doc.roundedRect(x, yPos, 3, totalHeight, r, 0, 'F'); 
            doc.rect(x+1.5, yPos, 1.5, totalHeight, 'F'); 
        }

        // Render content
        let currentY = yPos + 8;
        content.forEach(item => {
            if (item.type === 'text') {
                txt(item.text, item.fontSize || 9, item.style || 'normal', item.color || C.text);
                const lines = doc.splitTextToSize(item.text, item.maxWidth || w - 20);
                lines.forEach(line => {
                    doc.text(line, item.x || (x + 10), currentY + (item.lineHeight || 6));
                    currentY += item.lineHeight || 6;
                });
            } else if (item.type === 'space') {
                currentY += item.height;
            } else if (item.type === 'circle') {
                fill(item.color || C.blue);
                doc.circle(item.x || (x + 10), currentY + item.radius, item.radius, 'F');
                currentY += item.radius * 2;
            } else if (item.type === 'rect') {
                fill(item.color || C.blue);
                doc.rect(item.x || (x + 10), currentY, item.width, item.height, 'F');
                currentY += item.height;
            }
        });

        return totalHeight;
    };

    const secTitle = (title, yy, color = C.blue) => {
        const titleContent = [
            { type: 'text', text: title, fontSize: 11, style: 'bold', color: C.text, x: m, lineHeight: 7 },
            { type: 'space', height: 3 },
            { type: 'rect', x: m, width: 20, height: 1.5, color: color }
        ];
        const titleHeight = measureContent(titleContent);
        cp(titleHeight);
        
        txt(title, 11, 'bold', C.text); 
        doc.text(title, m, yy + 6);
        fill(color); 
        doc.rect(m, yy + 9, 20, 1.5, 'F');
        return yy + 15;
    };

    // =============================
    // PAGE 1: COVER
    // =============================
    fill(C.bg); doc.rect(0,0,pw,ph,'F');
    fill(C.card); stroke(C.border); doc.roundedRect(0,-5,pw,70,0,0,'FD');
    fill(C.blue); doc.circle(pw/2,18,6,'F');
    txt('🏢',10,'bold',C.white); doc.text('🏢',pw/2,21,{align:'center'});

    txt('BUSINESS DEPENDENCY REPORT',17,'bold',C.text); doc.text('BUSINESS DEPENDENCY REPORT',pw/2,38,{align:'center'});
    txt('What If You Left Tomorrow?',9,'normal',C.textMid);
    doc.text('What If You Left Tomorrow?',pw/2,46,{align:'center'});

    fill(C.bg); doc.roundedRect(pw/2-40,54,80,8,4,4,'F');
    txt(new Date().toLocaleDateString('en-US',{month:'long',day:'numeric',year:'numeric'}),7,'bold',C.textMid);
    doc.text(new Date().toLocaleDateString('en-US',{month:'long',day:'numeric',year:'numeric'}),pw/2,59,{align:'center'});

    y = 75;

    // Table of Contents - Dynamic
    const tocContent = [
        { type: 'text', text: "WHAT'S IN THIS REPORT:", fontSize: 8, style: 'bold', color: C.blue, x: m+8, lineHeight: 6 },
        { type: 'space', height: 6 }
    ];
    
    const toc = [
        'Page 1: Owner Dependency Index & Risk Assessment',
        'Page 2: Independence Roadmap & Valuation Impact', 
        'Page 3: Implementation Framework'
    ];
    
    toc.forEach(item => {
        const fitted = fitText(doc, item, cw-25, 7.5, 6);
        tocContent.push({ 
            type: 'circle', 
            x: m+10, 
            radius: 0.8, 
            color: C.blue 
        });
        tocContent.push({ 
            type: 'text', 
            text: item, 
            fontSize: fitted.fontSize, 
            x: m+14, 
            lineHeight: 5,
            maxWidth: cw-25
        });
    });

    const tocHeight = dynamicCard(m, y, cw, tocContent, {accent: C.blue});
    y += tocHeight + 8;

    // Score visualization card - Dynamic
    const scoreCol = d.totalScore >= 80 ? C.red : d.totalScore >= 50 ? C.amber : C.green;
    const scoreContent = [
        { type: 'text', text: 'OWNER DEPENDENCY INDEX', fontSize: 9, style: 'bold', color: scoreCol, x: m+cw/2, lineHeight: 8 },
        { type: 'space', height: 4 },
        { type: 'circle', x: m+cw/2, radius: 10, color: scoreCol },
        { type: 'text', text: d.totalScore.toString(), fontSize: 16, style: 'bold', color: C.white, x: m+cw/2, lineHeight: 8 },
        { type: 'space', height: 3 },
        { type: 'text', text: d.verdict, fontSize: 8, color: C.textMid, x: m+cw/2, lineHeight: 6, maxWidth: cw-20 }
    ];
    
    const scoreHeight = dynamicCard(m, y, cw, scoreContent, {accent: scoreCol});
    y += scoreHeight + 8;

    // Risk summary - Dynamic
    const critical = d.answers.filter(a=>a.score>=8).length;
    const atRisk = d.answers.filter(a=>a.score>=4&&a.score<8).length;
    const healthy = d.answers.filter(a=>a.score<4).length;
    const metW = (cw-10)/3;
    
    [{val:critical,label:'CRITICAL',color:C.red},{val:atRisk,label:'AT RISK',color:C.amber},{val:healthy,label:'HEALTHY',color:C.green}].forEach((mt,i) => {
        const x = m + i*(metW+5);
        const metricContent = [
            { type: 'text', text: mt.val.toString(), fontSize: 16, style: 'bold', color: mt.color, x: x+metW/2, lineHeight: 8 },
            { type: 'space', height: 2 },
            { type: 'text', text: mt.label+' AREAS', fontSize: 6, style: 'bold', color: C.text, x: x+metW/2, lineHeight: 6 }
        ];
        
        cp(measureContent(metricContent) + 16);
        dynamicCard(x, y, metW, metricContent, {accent: mt.color});
    });
    y += measureContent([{ type: 'text', text: 'Sample', fontSize: 16, lineHeight: 8 }, { type: 'space', height: 2 }, { type: 'text', text: 'Sample', fontSize: 6, lineHeight: 6 }]) + 24;

    // Risk assessment breakdown - Dynamic
    y = secTitle('RISK ASSESSMENT BY AREA', y);
    
    d.answers.sort((a,b)=>b.score-a.score).forEach(a => {
        const rColor = a.score>=8 ? C.red : a.score>=4 ? C.amber : C.green;
        const level = a.score>=8 ? 'CRITICAL' : a.score>=4 ? 'AT RISK' : 'HEALTHY';
        
        const riskContent = [
            { type: 'circle', x: m+10, radius: 1.5, color: rColor },
            { type: 'text', text: a.category.toUpperCase(), fontSize: 8, style: 'bold', color: C.text, x: m+16, lineHeight: 6 },
            { type: 'space', height: 2 }
        ];
        
        const riskHeight = dynamicCard(m, y, cw, riskContent);
        
        // Draw progress bar after card
        const barX = m+60, barW = cw-90;
        fill(C.bg); doc.roundedRect(barX, y+5, barW, 3, 1, 1, 'F');
        fill(rColor); doc.roundedRect(barX, y+5, (a.score/10)*barW, 3, 1, 1, 'F');
        
        txt(level, 7, 'bold', rColor); 
        doc.text(level, pw-m-10, y+8, {align:'right'});
        
        y += riskHeight + 8;
    });

    // =============================
    // INDEPENDENCE ROADMAP
    // =============================
    newPage();
    y = secTitle('INDEPENDENCE ROADMAP', y);
    
    const roadmap = {
        Operations: {title:"Systematize Operations",steps:["Document order handling step by step.","Create tiered approvals: <$X auto.","Train team leads on key accounts.","Implement tracking dashboards."]},
        Pricing: {title:"Codify Pricing Knowledge",steps:["Centralize special arrangements.","Create logic-based pricing matrix.","Train team on margin rules.","Implement ERP approval workflows."]},
        Knowledge: {title:"Transfer Knowledge",steps:["Record key process screencasts.","Create emergency handbook.","Build company wiki (SOPs).","Host weekly knowledge sessions."]},
        Decisions: {title:"Delegate Authority",steps:["List recurring decisions.","Write clear decision frameworks.","Formally authorize team leads.","Monitor outcomes, provide feedback."]},
        Relationships: {title:"Multi-Thread Relationships",steps:["Introduce leads to top clients.","Conduct joint business reviews.","Transition routine comms to team.","Systematize relationship management."]}
    };

    d.answers.filter(a=>a.score>=4).slice(0,4).forEach((a,idx) => {
        const plan = roadmap[a.category] || {title:a.category, steps:["Document current process.","Delegate small tasks.","Monitor performance.","Review outcomes." ]};
        
        const planContent = [
            { type: 'text', text: `${idx+1}. ${plan.title.toUpperCase()}`, fontSize: 9, style: 'bold', color: C.blue, x: m+10, lineHeight: 8 },
            { type: 'space', height: 4 }
        ];
        
        plan.steps.slice(0,3).forEach(s => {
            const fitted = fitText(doc, s, cw-25, 8, 7);
            planContent.push({ type: 'circle', x: m+12, radius: 1, color: C.blue });
            planContent.push({ 
                type: 'text', 
                text: s, 
                fontSize: fitted.fontSize, 
                x: m+16, 
                lineHeight: 7,
                maxWidth: cw-25
            });
        });

        const planHeight = dynamicCard(m, y, cw, planContent, {accent: C.blue});
        y += planHeight + 8;
    });

    // Valuation impact - Dynamic
    y = secTitle('VALUATION IMPACT', y);
    const hw = (cw-6)/2;
    
    const leftContent = [
        { type: 'text', text: 'OWNER-DEPENDENT', fontSize: 6, style: 'bold', color: C.red, x: m+8, lineHeight: 6 },
        { type: 'text', text: '2-3x', fontSize: 16, style: 'bold', color: C.red, x: m+8, lineHeight: 8 },
        { type: 'text', text: 'earnings multiple', fontSize: 7, color: C.textMid, x: m+8, lineHeight: 6 }
    ];
    
    const rightContent = [
        { type: 'text', text: 'SYSTEMATIZED', fontSize: 6, style: 'bold', color: C.green, x: m+hw+12, lineHeight: 6 },
        { type: 'text', text: '4-6x', fontSize: 16, style: 'bold', color: C.green, x: m+hw+12, lineHeight: 8 },
        { type: 'text', text: 'earnings multiple', fontSize: 7, color: C.textMid, x: m+hw+12, lineHeight: 6 }
    ];
    
    const leftHeight = dynamicCard(m, y, hw, leftContent, {accent: C.red});
    dynamicCard(m+hw+6, y, hw, rightContent, {accent: C.green});
    y += leftHeight + 8;

    // CTA - Dynamic
    const ctaContent = [
        { type: 'text', text: "BUILD A BUSINESS THAT RUNS WITHOUT YOU", fontSize: 11, style: 'bold', color: C.text, x: pw/2, lineHeight: 8 },
        { type: 'text', text: "Let's create the systems and automation that set you free.", fontSize: 8, color: C.textMid, x: pw/2, lineHeight: 6 },
        { type: 'text', text: 'mo@deeplineop.ai', fontSize: 11, style: 'bold', color: C.blue, x: pw/2, lineHeight: 8 }
    ];
    
    const ctaHeight = measureContent(ctaContent) + 16;
    cp(ctaHeight);
    
    stroke(C.blue); doc.setLineWidth(1);
    fill(C.white); doc.roundedRect(m, y, cw, ctaHeight, 3, 3, 'FD');
    
    let ctaY = y + 8;
    ctaContent.forEach(item => {
        txt(item.text, item.fontSize, item.style, item.color);
        doc.text(item.text, item.x, ctaY + item.lineHeight, {align: 'center'});
        ctaY += item.lineHeight + 2;
    });

    // Footer
    const pc = doc.internal.getNumberOfPages();
    for(let i=1;i<=pc;i++){
        doc.setPage(i);
        fill(C.white); stroke(C.border); doc.rect(0,ph-10,pw,10,'FD');
        txt('Deep Line Operations | AI Automation for Distributors',6,'normal',C.textMid);
        doc.text('Deep Line Operations | AI Automation for Distributors',m,ph-4);
        txt(`Page ${i} of ${pc}`,6,'normal',C.textMid);
        doc.text(`Page ${i} of ${pc}`,pw-m,ph-4,{align:'right'});
    }
    doc.save('Business-Dependency-Report.pdf');
}


init();
</script>
<!-- Navigation Menu --><div id="nav-menu" style="position:fixed;top:16px;right:16px;z-index:10000;font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,sans-serif;">
    <button id="nav-toggle" style="background:#12121a;border:1px solid #2a2a3a;color:#f1f5f9;padding:8px 14px;border-radius:8px;cursor:pointer;font-weight:600;display:flex;align-items:center;gap:8px;box-shadow:0 4px 12px rgba(0,0,0,0.5);font-size:14px;">
        <svg width="18" height="18" viewBox="0 0 18 18" fill="none"><rect y="3" width="18" height="2" rx="1" fill="#f1f5f9"/><rect y="8" width="18" height="2" rx="1" fill="#f1f5f9"/><rect y="13" width="18" height="2" rx="1" fill="#f1f5f9"/></svg>
        Tools
    </button>
    <div id="nav-content" style="display:none;position:absolute;top:48px;right:0;background:#12121a;border:1px solid #2a2a3a;border-radius:12px;width:270px;padding:8px;box-shadow:0 8px 24px rgba(0,0,0,0.7);">
        <a href="index.html" style="display:flex;align-items:center;gap:10px;padding:10px 12px;color:#f1f5f9;text-decoration:none;border-radius:6px;font-size:14px;border-left:3px solid #6366f1;background:rgba(99,102,241,0.08);margin-bottom:4px;">
            <img src="logo-icon.png" alt="" style="height:18px;width:18px;object-fit:contain;">
            <strong>All Tools</strong>
        </a>
        <div style="height:1px;background:#2a2a3a;margin:6px 4px;"></div>
        <a href="business-dependency.html" class="nav-link" data-color="#3b82f6" style="display:flex;align-items:center;gap:10px;padding:9px 12px;color:#94a3b8;text-decoration:none;border-radius:6px;font-size:13px;">
            <svg width="18" height="18" viewBox="0 0 18 18" fill="none"><path d="M9 2l6 4v6l-6 4-6-4V6l6-4z" stroke="#3b82f6" stroke-width="1.5" stroke-linejoin="round"/><circle cx="9" cy="9" r="2" fill="#3b82f6"/></svg>
            Business Dependency
        </a>
        <a href="ceo-time-audit.html" class="nav-link" data-color="#f59e0b" style="display:flex;align-items:center;gap:10px;padding:9px 12px;color:#94a3b8;text-decoration:none;border-radius:6px;font-size:13px;">
            <svg width="18" height="18" viewBox="0 0 18 18" fill="none"><rect x="2" y="3" width="14" height="12" rx="2" stroke="#f59e0b" stroke-width="1.5"/><path d="M2 7h14M6 3v-1M12 3v-1" stroke="#f59e0b" stroke-width="1.5" stroke-linecap="round"/><rect x="5" y="9" width="2" height="2" rx=".5" fill="#f59e0b"/><rect x="8" y="9" width="2" height="2" rx=".5" fill="#f59e0b"/></svg>
            CEO Time Audit
        </a>
        <a href="profit-leak-diagnostic.html" class="nav-link" data-color="#ef4444" style="display:flex;align-items:center;gap:10px;padding:9px 12px;color:#94a3b8;text-decoration:none;border-radius:6px;font-size:13px;">
            <svg width="18" height="18" viewBox="0 0 18 18" fill="none"><circle cx="9" cy="9" r="7.5" stroke="#ef4444" stroke-width="1.5"/><path d="M9 5v5l3 2" stroke="#ef4444" stroke-width="1.5" stroke-linecap="round"/><path d="M12 3l2-1M6 3L4 2" stroke="#ef4444" stroke-width="1.2" stroke-linecap="round"/></svg>
            Profit Leak Diagnostic
        </a>
        <a href="ai-readiness-scorecard.html" class="nav-link" data-color="#a855f7" style="display:flex;align-items:center;gap:10px;padding:9px 12px;color:#94a3b8;text-decoration:none;border-radius:6px;font-size:13px;">
            <svg width="18" height="18" viewBox="0 0 18 18" fill="none"><rect x="1" y="1" width="16" height="16" rx="3" stroke="#a855f7" stroke-width="1.5"/><path d="M5 12V8M9 12V5M13 12V9" stroke="#a855f7" stroke-width="2" stroke-linecap="round"/></svg>
            AI Readiness Scorecard
        </a>
        <a href="rfq-parser.html" class="nav-link" data-color="#06b6d4" style="display:flex;align-items:center;gap:10px;padding:9px 12px;color:#94a3b8;text-decoration:none;border-radius:6px;font-size:13px;">
            <svg width="18" height="18" viewBox="0 0 18 18" fill="none"><rect x="3" y="1" width="12" height="16" rx="2" stroke="#06b6d4" stroke-width="1.5"/><path d="M6 5h6M6 8h6M6 11h4" stroke="#06b6d4" stroke-width="1.2" stroke-linecap="round"/></svg>
            RFQ Parser
        </a>
        <a href="reorder-calculator.html" class="nav-link" data-color="#22c55e" style="display:flex;align-items:center;gap:10px;padding:9px 12px;color:#94a3b8;text-decoration:none;border-radius:6px;font-size:13px;">
            <svg width="18" height="18" viewBox="0 0 18 18" fill="none"><rect x="2" y="6" width="14" height="10" rx="2" stroke="#22c55e" stroke-width="1.5"/><path d="M6 6V4a3 3 0 016 0v2" stroke="#22c55e" stroke-width="1.5"/><circle cx="9" cy="11" r="1.5" fill="#22c55e"/></svg>
            Reorder Calculator
        </a>
    </div>
</div>
<script>
(function(){
    var tgl=document.getElementById('nav-toggle'),cnt=document.getElementById('nav-content');
    if(!tgl||!cnt)return;
    tgl.onclick=function(e){e.stopPropagation();var v=cnt.style.display==='block';cnt.style.display=v?'none':'block';tgl.style.background=v?'#12121a':'#1a1a25';};
    document.addEventListener('click',function(){cnt.style.display='none';tgl.style.background='#12121a';});
    cnt.onclick=function(e){e.stopPropagation();};
    var links=document.querySelectorAll('.nav-link');
    links.forEach(function(l){
        l.onmouseenter=function(){l.style.background='rgba(255,255,255,0.06)';l.style.color='#f1f5f9';};
        l.onmouseleave=function(){if(!l.classList.contains('nav-active')){l.style.background='';l.style.color='#94a3b8';}};
    });
    var cur=window.location.pathname.split('/').pop()||'index.html';
    document.querySelectorAll('#nav-content a').forEach(function(a){
        if(a.getAttribute('href')===cur||(cur===''&&a.getAttribute('href')==='index.html')){
            a.classList.add('nav-active');a.style.background='rgba(255,255,255,0.1)';a.style.color='#fff';a.style.fontWeight='600';
        }
    });
})();
</script>
</body>
</html>
